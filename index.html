<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>小狒sin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="小狒sin">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="小狒sin">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小狒sin">
  
    <link rel="alternative" href="/atom.xml" title="小狒sin" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xokdi.com1.z0.glb.clouddn.com/avatar.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Sinker</a></h1>
		</hgroup>

		
		<p class="header-subtitle">18 Til I Die</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/s1nker" title="github">github</a>
					        
								<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/sin-chaw" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="mailto:s1nker@126.com" title="mail">mail</a>
					        
								<a class="linkedin" target="_blank" href="https://cn.linkedin.com/in/s1nker" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Base64/" style="font-size: 10px;">Base64</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/E2E-测试/" style="font-size: 10px;">E2E 测试</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/FormData/" style="font-size: 10px;">FormData</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/Nightmare/" style="font-size: 10px;">Nightmare</a> <a href="/tags/Safari/" style="font-size: 10px;">Safari</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/development-docs/" style="font-size: 10px;">development docs</a> <a href="/tags/feeling/" style="font-size: 10px;">feeling</a> <a href="/tags/iOS/" style="font-size: 10px;">iOS</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/js对象/" style="font-size: 10px;">js对象</a> <a href="/tags/life/" style="font-size: 15px;">life</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/作用域/" style="font-size: 10px;">作用域</a> <a href="/tags/前端/" style="font-size: 10px;">前端</a> <a href="/tags/单元测试/" style="font-size: 10px;">单元测试</a> <a href="/tags/深拷贝/" style="font-size: 10px;">深拷贝</a> <a href="/tags/组件封装/" style="font-size: 10px;">组件封装</a> <a href="/tags/自动化测试/" style="font-size: 10px;">自动化测试</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">热爱分享，乐于折腾的前端程序猿，脑洞有点大！</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Sinker</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://7xokdi.com1.z0.glb.clouddn.com/avatar.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Sinker</h1>
			</hgroup>
			
			<p class="header-subtitle">18 Til I Die</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/s1nker" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/sin-chaw" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="mailto:s1nker@126.com" title="mail">mail</a>
			        
						<a class="linkedin" target="_blank" href="https://cn.linkedin.com/in/s1nker" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-e2e-test-n-nightmare" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/03/29/e2e-test-n-nightmare/" class="article-date">
  	<time datetime="2018-03-28T16:00:00.000Z" itemprop="datePublished">2018-03-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/29/e2e-test-n-nightmare/">E2E 测试与自动化测试工具 Nightmare</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-前端的自动化测试"><a href="#1-前端的自动化测试" class="headerlink" title="1. 前端的自动化测试"></a>1. 前端的自动化测试</h1><h2 id="1-2-单元测试"><a href="#1-2-单元测试" class="headerlink" title="1.2 单元测试"></a>1.2 单元测试</h2><p><strong>单元测试</strong>往往只关注于一个代码片段，通常是一个模块或函数。实际应用中会将代码拆分成若干个小的组件，这也意味着你会写很多的单元测试用例来保证代码的功能正常。</p>
<p>前端开发中的单元测试工具有 <a href="https://facebook.github.io/jest/zh-Hans/" target="_blank" rel="external">jest</a>、<a href="https://mochajs.org/" target="_blank" rel="external">mocha</a>、<a href="https://jasmine.github.io/" target="_blank" rel="external">jasmine</a> 和 <a href="https://qunitjs.com/" target="_blank" rel="external">qunit</a>。</p>
<h2 id="1-3-E2E-测试"><a href="#1-3-E2E-测试" class="headerlink" title="1.3. E2E 测试"></a>1.3. E2E 测试</h2><p><strong>E2E</strong>（end to end）测试即<strong>端到端测试</strong>是，也称冒烟测试，用于测试真实浏览器环境下前端应用的流程和表现，相当于代替人工去操作应用。E2E 测试是一个边界比较模糊的概念，有以下几个特点：</p>
<ul>
<li>把整个系统当作一个黑盒</li>
<li>测试人员模拟真实用户在浏览器中操作UI</li>
<li>测试出的问题可能是前端也可能是后端导致的</li>
</ul>
<p>常见的 E2E 测试工具有 <a href="http://www.nightmarejs.org/" target="_blank" rel="external">nightmare</a>、nightwatch 和 <a href="https://github.com/googlechrome/puppeteer" target="_blank" rel="external">puppeteer</a>。</p>
<h2 id="1-4-单元测试和-E2E-测试的对比"><a href="#1-4-单元测试和-E2E-测试的对比" class="headerlink" title="1.4. 单元测试和 E2E 测试的对比"></a>1.4. 单元测试和 E2E 测试的对比</h2><p>单元测试的概念出现已久，相关的工具体系也已经十分完善，但是单元测试的维护成本较高，并且对于前端测试来说有很多需求无法满足。此外，单元测试需要较多的角度完善的测试用例支持，且这些测试用例都是较为简单的，针对每一个小模块或者组建的输入与输出。</p>
<p>E2E 测试针对具体的测试环境条件来编写测试用例，一般情况下测试用例不会太多.</p>
<h2 id="1-5-TDD-和-BDD"><a href="#1-5-TDD-和-BDD" class="headerlink" title="1.5. TDD 和 BDD"></a>1.5. TDD 和 BDD</h2><p><strong>TDD</strong>（Test Drive Development）即<strong>测试驱动开发</strong>。简单的说就是先根据需求写测试用例，再代码实现，接着测试，循环此过程直到产品的实现。可以看出来，TDD 的基本思路就是通过测试来推动整个开发的进行，但测试驱动开发并不只是单纯的测试工作，而是把需求分析，设计，质量控制量化的过程。</p>
<p><strong>BDD</strong>（Behavior Drive Development）即<strong>行为驱动开发</strong>，BDD 可以看作是对 TDD 的一种补充，或者说是 TDD 的一个分支。在TDD中，我们并不能完全保证根据设计所编写的测试就是用户所期望的功能。BDD将这一部分简单和自然化，用自然语言来描述，让开发、测试、BA以及客户都能在这个基础上达成一致。BDD 更加依赖于需求行为和文档来驱动开发，这些文档的描述跟测试代码很相似。</p>
<p>通过对比，TDD 通过测试来推动整个开发的进行。这有助于编写简洁可用和高质量的代码，并加速实际开发过程，可能导致的问题是需求和开发脱节，实际产品与用户所需要的功能并不匹配。而 BDD 通过鼓励项目中的开发者、QA 和非技术人员或商业参与者之间进行协作，确保程序实现效果与用户需求一致。</p>
<p>可以看出 <strong>E2E 测试</strong>更多的是换和 <strong>BDD</strong> 的开发模式进行结合,实际应用用会将 E2E 的测试工具和 BDD 测试框架进行结合。</p>
<h1 id="2-Nightmare"><a href="#2-Nightmare" class="headerlink" title="2. Nightmare"></a>2. Nightmare</h1><h2 id="2-1-基本介绍"><a href="#2-1-基本介绍" class="headerlink" title="2.1.基本介绍"></a>2.1.基本介绍</h2><p>Nightmare 是一个基于 electron 的浏览器自动化代码库，用于实现爬虫或自动化测试。相较于传统的爬虫框架（scrapy/pyspider），或者dom操作库（cheerio/jsdom），或者基于浏览器的自动化框架（selenium/phantomjs），他的优势在于提供了一个<strong>简洁有效</strong>的编程模型。</p>
<p>官网给出的实现一个向yahoo自动提交关键词并搜索的功能如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">yield</span> Nightmare()</div><div class="line">  .goto(<span class="string">'http://yahoo.com'</span>)</div><div class="line">  .type(<span class="string">'input[title="Search"]'</span>, <span class="string">'github nightmare'</span>)</div><div class="line">  .click(<span class="string">'.searchsubmit'</span>);</div></pre></td></tr></table></figure>
<h2 id="2-2-相关-API"><a href="#2-2-相关-API" class="headerlink" title="2.2. 相关 API"></a>2.2. 相关 API</h2><p>基本的交互 API 包括：</p>
<ul>
<li><code>goto(url[, headers])</code> 跳转到url</li>
<li><code>viewport(width,</code> height) 浏览器窗口大小</li>
<li><code>wait(selector)</code> 等待某个dom元素出现</li>
<li><code>click(selector)</code> 点击某个dom元素</li>
<li><code>type(selector[, text])</code> 在某个dom元素中输入</li>
<li><code>inject(type, file)</code> 在页面上挂载 js/css 文件内容</li>
<li><code>evaluate(fn[, arg1, arg2,...])</code> 在客户端注入JS脚本并执行，从而实现electron模型下的C/S互动及数据交换</li>
<li>……</li>
</ul>
<h2 id="2-3-实例"><a href="#2-3-实例" class="headerlink" title="2.3. 实例"></a>2.3. 实例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Nightmare <span class="keyword">from</span> <span class="string">'nightmare'</span>;</div><div class="line"></div><div class="line">describe(<span class="string">'Login'</span>, () =&gt; &#123;</div><div class="line">  <span class="keyword">let</span> page;</div><div class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    page = Nightmare();</div><div class="line">    page.goto(<span class="string">'http://localhost:8000/#/user/login'</span>);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'should login with failure'</span>, <span class="keyword">async</span> () =&gt; &#123;</div><div class="line">    <span class="keyword">await</span> page.type(<span class="string">'#userName'</span>, <span class="string">'mockuser'</span>)</div><div class="line">      .type(<span class="string">'#password'</span>, <span class="string">'wrong_password'</span>)</div><div class="line">      .click(<span class="string">'button[type="submit"]'</span>)</div><div class="line">      .wait(<span class="string">'.ant-alert-error'</span>) <span class="comment">// should display error</span></div><div class="line">      .end();</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'should login successfully'</span>, <span class="keyword">async</span> () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> text = <span class="keyword">await</span> page.type(<span class="string">'#userName'</span>, <span class="string">'admin'</span>)</div><div class="line">      .type(<span class="string">'#password'</span>, <span class="string">'888888'</span>)</div><div class="line">      .click(<span class="string">'button[type="submit"]'</span>)</div><div class="line">      .wait(<span class="string">'.ant-layout-sider h1'</span>) <span class="comment">// should display error</span></div><div class="line">      .evaluate(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">document</span>.body.innerHTML)</div><div class="line">      .end();</div><div class="line">    expect(text).toContain(<span class="string">'&lt;h1&gt;Ant Design Pro&lt;/h1&gt;'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> expect = <span class="built_in">require</span>(<span class="string">'chai'</span>).expect;</div><div class="line"><span class="keyword">const</span> Nightmare = <span class="built_in">require</span>(<span class="string">'nightmare'</span>);</div><div class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</div><div class="line"></div><div class="line">describe(<span class="string">'simulate search'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">　　<span class="keyword">this</span>.timeout(<span class="string">'30s'</span>)</div><div class="line"> </div><div class="line">　　<span class="keyword">let</span> nightmare = <span class="literal">null</span></div><div class="line">　　beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">　　　　<span class="comment">// 设置显示模拟弹框</span></div><div class="line">　　　　nightmare = <span class="keyword">new</span> Nightmare(&#123;</div><div class="line">　　　　show: <span class="literal">true</span>,</div><div class="line">　　　&#125;)</div><div class="line">　　&#125;)</div><div class="line"> </div><div class="line">　　it(<span class="string">'模拟用户搜索'</span>, <span class="function"><span class="params">done</span> =&gt;</span> &#123;</div><div class="line">　　　　nightmare</div><div class="line">　　　　.goto(<span class="string">'https://www.baidu.com/'</span>)  <span class="comment">//设置搜索引擎</span></div><div class="line">　　　　.viewport(<span class="number">1200</span>, <span class="number">672</span>) 　 <span class="comment">//设置弹框视口宽高　　　　　　　　</span></div><div class="line">　　　　.type(<span class="string">'form[action*="/s"] [name=wd]'</span>, <span class="string">'github nightmare'</span>)   <span class="comment">//获取搜索框，自动填充搜索内容</span></div><div class="line">　　　　.click(<span class="string">'form[action*="/s"] [type=submit]'</span>)  <span class="comment">//获取点击按钮，模拟点击</span></div><div class="line">　　　　.wait(<span class="number">5000</span>) <span class="comment">//等待5s(可为dom节点)，获取第一条的信息的内容</span></div><div class="line">　　　　.evaluate(<span class="function"><span class="params">()</span> =&gt;</span></div><div class="line">　　　　　<span class="built_in">document</span>.querySelector(<span class="string">'#content_left .c-container a em'</span>).innerHTML</div><div class="line">　　　　)</div><div class="line">　　　　.end()</div><div class="line">　　　　.then(<span class="function"><span class="params">content</span> =&gt;</span> &#123;</div><div class="line">　　　　　<span class="built_in">console</span>.log(content === <span class="string">'Nightmare'</span>,<span class="string">'-----&gt;true'</span>)  <span class="comment">//输出结果</span></div><div class="line">		  done();</div><div class="line">　　　　&#125;)</div><div class="line">　　　　.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</div><div class="line">　　　　　<span class="built_in">console</span>.error(<span class="string">'Search failed:'</span>, error);  <span class="comment">//输出捕捉到的错误</span></div><div class="line">		  done();</div><div class="line">　　　　&#125;);</div><div class="line">　　&#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>参考：</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000008915567" target="_blank" rel="external">测试你的前端代码 - part3（端到端测试）</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/E2E-测试/">E2E 测试</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nightmare/">Nightmare</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/单元测试/">单元测试</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/自动化测试/">自动化测试</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-base64-convert-to-upload" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/03/02/base64-convert-to-upload/" class="article-date">
  	<time datetime="2018-03-01T16:00:00.000Z" itemprop="datePublished">2018-03-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/02/base64-convert-to-upload/">Base64 图片数据转换上传</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-base64"><a href="#1-base64" class="headerlink" title="1. base64"></a>1. base64</h1><h2 id="1-1-背景介绍"><a href="#1-1-背景介绍" class="headerlink" title="1.1. 背景介绍"></a>1.1. 背景介绍</h2><blockquote>
<p>Base64是网络上最常见的用于传输 8Bit 字节码的编码方式之一，Base64 就是一种基于 64 个可打印字符来表示二进制数据的方法。</p>
</blockquote>
<p>用记事本打开exe、jpg、pdf这些文件时，我们都会看到一大堆乱码，因为二进制文件包含很多无法显示和打印的字符，所以，如果要让记事本这样的文本处理软件能处理二进制数据，就需要一个二进制到字符串的转换方法。Base64 就是一种最常见的二进制编码方法。</p>
<p>简单的说，Base64 将 8 位的非英语字符转化为 7 位的 ASCII 字符。最初为了解决电子邮件中不能直接使用非 ASCII 码字符的问题而被提出，除此之外还有别的意义：</p>
<ul>
<li>所有的二进制文件，都可以因此转化为可打印的文本编码，使用文本软件进行编辑</li>
<li>能够对文本进行简单的加密</li>
</ul>
<h2 id="1-2-原理简析"><a href="#1-2-原理简析" class="headerlink" title="1.2. 原理简析"></a>1.2. 原理简析</h2><p>Base64，就是说选出64个字符：</p>
<ul>
<li>小写字母 a-z</li>
<li>大写字母 A-Z</li>
<li>数字 0-9</li>
<li>符号 “+”、”/“</li>
</ul>
<p>实际上还有作为垫字的“=”，所以在一段 base64 文本中会看到 65 个字符。将除了ASCII字符以外的其他所有符号都转换成这个字符集中的字符。</p>
<p>Base64 对二进制数据进行处理，每 3 个字节一组，一共是 3 x 8 = 24bit，划为4组，每组正好 6 个 bit：</p>
<p><img src="http://" alt="base64-coding"></p>
<p>得到四个 6 位的数据之后给每一个开头加上 <code>00</code>，这样 3 个字节的数据就转成了 4 个字节。正是因此经过 Base64 编码过的数据会在大小上增加 33% 左右。</p>
<p>如果要编码的二进制数据不是 3 的倍数，实际编码可能会在最后剩下 1 个或 2 个字节，Base64用 <code>\x00</code> 字节在末尾补足后，再在编码的末尾加上 1 个或 2 个 = 号，表示补了多少字节，在解码的时候，会自动去掉。</p>
<h1 id="2-相关方法"><a href="#2-相关方法" class="headerlink" title="2. 相关方法"></a>2. 相关方法</h1><h2 id="2-1-window-atob-和-window-btoa"><a href="#2-1-window-atob-和-window-btoa" class="headerlink" title="2.1. window.atob() 和 window.btoa()"></a>2.1. <code>window.atob()</code> 和 <code>window.btoa()</code></h2><p>在JavaScript中，有 2 个函数分别用来处理解码和编码 Base64 字符串：</p>
<ul>
<li><code>window.atob()</code>：对用 Base64 编码过的字符串进行解码</li>
<li><code>window.btoa()</code>：从 String 对象中创建一个 Base64 编码的 ASCII 字符串，其中字符串中的每个字符都被视为一个二进制数据字节</li>
</ul>
<h2 id="2-2-Uint8Array"><a href="#2-2-Uint8Array" class="headerlink" title="2.2. Uint8Array"></a>2.2. Uint8Array</h2><p><code>Uint8Array</code> 数组类型表示一个 8 位无符号整型数组，创建时内容被初始化为 0。</p>
<p>创建完后，可以以对象的方式或使用数组下标索引的方式引用数组中的元素。</p>
<h2 id="2-3-Blob"><a href="#2-3-Blob" class="headerlink" title="2.3. Blob"></a>2.3. Blob</h2><p>Blob 对象表示一个不可变、原始数据的类文件对象。Blob 表示的不一定是 JavaScript 原生格式的数据。File 接口基于Blob，继承了 blob 的功能并将其扩展使其支持用户系统上的文件。</p>
<p>要构建一个 Blob 对象可以使用 <code>Blob()</code> 构造函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> aBlob = <span class="keyword">new</span> Blob( <span class="built_in">array</span>, options );</div></pre></td></tr></table></figure>
<p><code>Blob()</code> 构造函数返回的 Blob 对象内容由参数数组中给出的值的串联组成。参数如下：</p>
<ul>
<li>array 是一个由ArrayBuffer, ArrayBufferView, Blob, DOMString 等对象构成的 Array ，或者其他类似对象的混合体，它将会被放进 Blob。DOMStrings会被编码为UTF-8</li>
<li>options 是一个可选的 BlobPropertyBag 字典，它可能会指定如下两个属性：key 和 ending</li>
</ul>
<h1 id="3-具体实现"><a href="#3-具体实现" class="headerlink" title="3. 具体实现"></a>3. 具体实现</h1><p>为了将 Base64 数据转换成二进制的数据进行上传，可以分成以下几个步骤：</p>
<ol>
<li>去掉 Base64 图片数据字串中开头一些类型说明的内容</li>
<li>取出 Base64 图片数据字串中的 MIME 说明</li>
<li>用 <code>window.atob()</code> 解码 Base64 转换成图片原生的数据字串</li>
<li>将得到的图片原生字串放入 Uint8Array</li>
<li>转换成 Blob 格式</li>
<li>调用 FormData 的 <code>append()</code> 插入 Blob 数据，连同 form 中的数据一同发送</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 将base64转换成二进制图片（Blob）</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataURItoBlob</span> (<span class="params">base64Data</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> byteString = <span class="built_in">window</span>.atob(base64Data.split(<span class="string">','</span>)[<span class="number">1</span>]); <span class="comment">// 去掉url的头，是一段类型说明</span></div><div class="line">  <span class="keyword">const</span> mimeString = base64Data.split(<span class="string">','</span>)[<span class="number">0</span>].split(<span class="string">':'</span>)[<span class="number">1</span>].split(<span class="string">';'</span>)[<span class="number">0</span>]; <span class="comment">// 取出 MIME类型</span></div><div class="line"></div><div class="line">  <span class="keyword">let</span> ia = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(byteString.length); <span class="comment">// </span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; byteString.length; i++) &#123;</div><div class="line">    ia[i] = byteString.charCodeAt(i);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Blob([ia], &#123; <span class="attr">type</span>: mimeString &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">'superagent'</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">submit</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> blob = dataURItoBlob(base64Data);</div><div class="line">  <span class="keyword">const</span> fd = <span class="keyword">new</span> FormData(<span class="built_in">document</span>.querySelector(<span class="string">'form'</span>));</div><div class="line">  fd.append(fileName, blob, file.file.name);</div><div class="line"></div><div class="line">  request.post(action)</div><div class="line">    .send(fd)</div><div class="line">    .end(<span class="function"><span class="keyword">function</span>(<span class="params">err, res</span>) </span>&#123;</div><div class="line">      <span class="comment">// eg.成功回调的处理逻辑</span></div><div class="line">      <span class="keyword">if</span> (err || !res.ok) &#123;</div><div class="line">        <span class="comment">// 处理 request 返回的请求错误</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"not 200 error msg:"</span> + err);</div><div class="line">        <span class="comment">// ...</span></div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// 处理后端返回的请求错误</span></div><div class="line">        <span class="keyword">if</span> (res.body.errorCode === <span class="number">0</span>) &#123;</div><div class="line">          <span class="comment">// do something ...</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          <span class="comment">// do something ...</span></div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>参考：</p>
<ul>
<li><a href="https://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/001399413803339f4bbda5c01fc479cbea98b1387390748000" target="_blank" rel="external">base64 - 廖雪峰的官方网站</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Base64/">Base64</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FormData/">FormData</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-hack-ios-11-n-iphone-X" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/01/31/hack-ios-11-n-iphone-X/" class="article-date">
  	<time datetime="2018-01-30T16:00:00.000Z" itemprop="datePublished">2018-01-31</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/31/hack-ios-11-n-iphone-X/">iOS 11 及 iPhone X 爬坑姿势</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-序言"><a href="#1-序言" class="headerlink" title="1 序言"></a>1 序言</h2><p>2017 年 9 月 12 日凌晨，苹果在乔布斯剧院发布了 iPhone X。iPhone X 正面的全面屏上方有一条刘海，对于如何适配 iPhone X，苹果的 Human Interface Guidelines 文档有给出相关的说明，但是对于前端开发者来说，我们还应该关注到更多的东西。</p>
<p>iOS 11 新引入了若干个 Webkit API 来解决带来的适配问题，使用这些新的 API 我们可以更好的利用 iPhone X 屏幕的特性。</p>
<h2 id="2-相关概念"><a href="#2-相关概念" class="headerlink" title="2 相关概念"></a>2 相关概念</h2><p>在了解新 API 之前需要先了解苹果设备屏幕的相关概念，接下来简单的对之进行说明。</p>
<h3 id="2-1-安全区域（Safe-Area）"><a href="#2-1-安全区域（Safe-Area）" class="headerlink" title="2.1 安全区域（Safe Area）"></a>2.1 安全区域（Safe Area）</h3><p>在苹果的 <a href="https://developer.apple.com/documentation/uikit/uiview/positioning_content_relative_to_the_safe_area" target="_blank" rel="external">UIKit文档</a> 中，提到了安全区域。</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/safe_area_1.png" alt="safe_area_1"></p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/safe_area_2.png" alt="safe_area_2"></p>
<p>简单的说，将内容放在这样的 Safe area 可以确保内容不会被设备圆角（corners），传感器外壳（sensor housing，齐刘海）以及底部的 Home Indicator 遮挡。</p>
<h2 id="3-相关-API"><a href="#3-相关-API" class="headerlink" title="3 相关 API"></a>3 相关 API</h2><h3 id="3-1-viewport-fit"><a href="#3-1-viewport-fit" class="headerlink" title="3.1 viewport-fit"></a>3.1 viewport-fit</h3><h4 id="3-1-1-基础介绍"><a href="#3-1-1-基础介绍" class="headerlink" title="3.1.1 基础介绍"></a>3.1.1 基础介绍</h4><p>iOS 11 与早期的版本有个不同的地方，Webview 内容将会尊重所谓的安全区域。这意味着，如果你有一个标题栏固定在顶部 <code>position: fixed; top: 0</code> 。它将会在屏幕顶部下面的 20px 开始渲染。当你向下滚动时，它会移动到状态栏的后面。当你向上滚动时，它会再次下降到状态栏下面，而且在 20px 的间隙中，内容会透出。在 <a href="https://ayogo.com/blog/ios11-viewport/" target="_blank" rel="external">Understanding the WebView Viewport in iOS 11</a> 这篇文章中的视频可以看到实际是怎么样的。不过这个恼人的问题通过给 <code>viewport-fit</code> 进行配置即可解决。</p>
<p><code>viewport-fit</code> 可以设置可视窗口（Visual Viewport）的大小。在设备的物理屏幕上看到的初始布局视窗。在圆形屏幕上，当前屏幕上显示的部分是圆形的，但是 Viewport 却是矩形的。因此，根据 Viewport 的大小，页面的某些部可能被剪切。</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/clipped_area.png" alt="clipped_area"></p>
<p><code>viewport-fit</code> 可以设置可视视窗的大小，也就是裁剪区域，<code>viewport-fit</code> 接收以下三个值：</p>
<ul>
<li><code>contain</code>：viewport 中可以显示整个页面的内容，也就是说那些 position 设置为 fixed 的元素会相对于 iOS 11 的安全区域定位。<blockquote>
<p>注意: 设置该属性值时，<code>border-boundary: display</code> 和 <code>shape-inside: display</code> 会失效。</p>
</blockquote>
</li>
<li><code>cover</code>：页面的内容完全覆盖整个 viewport。也就是说那些 <code>position: fixed</code> 的元素会相对于 viewport 定位，这就可能导致页面中有的内容会被遮盖。</li>
<li><code>auto</code>：默认值，表现与 contain 一致。</li>
</ul>
<p><a href="https://drafts.csswg.org/css-round-display/" target="_blank" rel="external">CSS Round Display Level 1</a> 中有给出了一些对于这个属性的建议：</p>
<blockquote>
<p>当在非矩形显示器上设置 viewport 的边界框（viewport Bounding Box）大小时，必须考虑以下因素：</p>
<ul>
<li>由于 viewport 边界框（viewport Bounding Box）的面积大于显示区域，导致剪切区域</li>
<li>在 Viewport 边界框和显示区域之间存在间隙</li>
</ul>
<p>开发人员可以决定哪一个因素比较重要。如果必须确保 web 页面的没有任何一部分被隐藏，那么避免发生剪裁的优先级要高于处理在 viewport 的边界框和屏幕的边框之间的间隙。如果不想让 web 页面被缩小导致可读性上降低，那么最好将 <code>viewport-fit</code> 设置为 cover ，但是要注意页面被裁剪的部分。</p>
</blockquote>
<p>我们直接看规范中给出的例子：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">viewport</span> (viewport-fit: contain) &#123;</div><div class="line">    <span class="comment">/* CSS for the rectangular design */</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/viewport_fit_contain.png" alt="viewport_fit_contain"></p>
<p>当将 <code>viewport-fit</code> 设置为 contain 时，viewport 会以显示完整的、最大的矩形页面为依据，去展示 web 内容。在 iPhone X 中可视区域内多余的区域会以白色的背景色显示。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">viewport</span> &#123;</div><div class="line">    <span class="selector-tag">viewport-fit</span>: <span class="selector-tag">cover</span>;</div><div class="line">&#125;</div><div class="line">@<span class="keyword">media</span> (shape: round)&#123;</div><div class="line">    <span class="comment">/* styles for the round design */</span></div><div class="line">&#125;</div><div class="line">@<span class="keyword">media</span> (shape: rect)&#123;</div><div class="line">    <span class="comment">/* styles for the rectangular design */</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/viewport_fit_cover.png" alt="viewport_fit_cover"></p>
<p>当将 <code>viewport-fit</code> 设置为 cover 时，初始的 viewport 会受限于非矩形的展示区域，以填满展示区域为依据进行展示。</p>
<h4 id="3-1-2-实际应用"><a href="#3-1-2-实际应用" class="headerlink" title="3.1.2 实际应用"></a>3.1.2 实际应用</h4><p>使用 <code>viewport-fit</code> 只需在 viewport 的声明中增加 <code>viewport-fit</code> 的配置即可。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0, viewport-fit=cover"</span>/&gt;</span></div></pre></td></tr></table></figure>
<p>通过给 <code>viewport-fit</code> 设置 cover 可以页面内容充满 iPhone X 的屏幕。下面是不作处理的 iPhone X 打开页面，可以看到有两条白边。</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/iphone_x_with_white_wings.png" alt="iphone_x_with_white_wings"></p>
<p>设置了 viewport-fit 为 cover 之后：</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/iphone_x_with_viewport_fit_cover.png" alt="iphone_x_with_viewport_fit_cover"></p>
<h3 id="3-2-safe-area-inset"><a href="#3-2-safe-area-inset" class="headerlink" title="3.2 safe-area-inset-*"></a>3.2 safe-area-inset-*</h3><h4 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h4><p>新出的 iPhone X 形状不规则，其状态栏的高不再是 20px，而且在摄像头和扬声器的设置下，你的标题栏内容将会完全无法访问到。需要注意的是，这也适用于固定在屏幕底部的页脚，它将被麦克风阻塞。在一开始的关于安全区域的图中就可以看到，底部是有一定区域在 safe area 之外。</p>
<p>在上面一个小节，通过设置 <code>viewport-fit</code> 我们将页面的内容铺满了整个屏幕，但是可以看到“齐刘海”会将一部分的内容遮挡，如果我们知道屏幕边缘到 safe area 边缘的距离，那就可以通过设置 <code>padding</code> 属性来解决这个问题了。</p>
<p>在设置 <code>viewport-fit=cover</code> 之后，Web 中会新增四个常量：</p>
<ul>
<li><p><code>safe-area-inset-top</code>：可视区域顶部边缘到安全区域的距离（以CSS像素为单位）</p>
</li>
<li><p><code>safe-area-inset-right</code>：可视区域最右边到安全区域的距离（以CSS像素为单位）</p>
</li>
<li><p><code>safe-area-inset-left</code>：可视区域最左边到安全区域的距离（以CSS像素为单位）</p>
</li>
<li><p><code>safe-area-inset-bottom</code>：可视区域底部边缘到安全区域的距离（以CSS像素为单位）</p>
</li>
</ul>
<p>对应地苹果添加了一个方法，将安全区域布局指南暴露给 CSS 。他们添加类似一个CSS的变量概念，叫作 CSS constants 。通过 <code>constant()</code> 就可以获取到上面的几个常量。<br>通过给页面的容器元素增加以下的样式属性：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">padding</span>: <span class="selector-tag">constant</span>(<span class="selector-tag">safe-area-inset-top</span>) <span class="selector-tag">constant</span>(<span class="selector-tag">safe-area-inset-right</span>) <span class="selector-tag">constant</span>(<span class="selector-tag">safe-area-inset-bottom</span>) <span class="selector-tag">constant</span>(<span class="selector-tag">safe-area-inset-left</span>);</div></pre></td></tr></table></figure>
<p>可以解决内容被遮挡的问题。</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/iphone_x_with_viewport_fit_cover_constant.png" alt="iphone_x_with_viewport_fit_cover_constant"></p>
<p>要注意在 <a href="https://ayogo.com/blog/ios11-viewport/" target="_blank" rel="external">Darryl Pogue 的文章</a>中说到：</p>
<blockquote>
<p>Note: iOS 11.0 uses the constant() syntax, but future versions will only support env()!</p>
</blockquote>
<p>在 iOS 11 中仍使用 <code>constant()</code>，但是在未来的版本将会抛弃 <code>constant()</code> 改用 <code>env()</code>。对此 Darryl Pogue 给出的一个关于 header 的样式例子如下，简单做了渐进增强。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">header</span> &#123;</div><div class="line">    <span class="attribute">position</span>: fixed;</div><div class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">44px</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* Status bar height on iOS 10 */</span></div><div class="line">    <span class="attribute">padding-top</span>: <span class="number">20px</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* Status bar height on iOS 11+ */</span></div><div class="line">    <span class="attribute">padding-top</span>: <span class="built_in">constant</span>(safe-area-inset-top);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-3-max-amp-min"><a href="#3-3-max-amp-min" class="headerlink" title="3.3 max() &amp; min ()"></a>3.3 max() &amp; min ()</h3><h4 id="3-3-1-基本介绍"><a href="#3-3-1-基本介绍" class="headerlink" title="3.3.1 基本介绍"></a>3.3.1 基本介绍</h4><blockquote>
<p>max() 和 min() 未当前版本未包含的功能</p>
</blockquote>
<p>如果你在网站设计中采用了 <code>safe-area-inset-*</code>，你可能会注意到，除了安全区域插入之外，你还需要指定最小的内填充。在上面页面中，如果我们使用了 <code>constant(safe-area-inset-left)</code>，当设备旋转回垂直方向时，左边的安全插入距离变成了 0px，文本便紧贴着屏幕边缘了。</p>
<p><code>min()</code> 和 <code>max()</code> 来实现，这两个函数会在未来的 Safari 技术预览版中可用。这两个函数都接受任意数量的参数，并返回最小值或最大值。它们能用在calc()里面，或者彼此嵌套。并且这两个函数都允许使用calc（）作为参数，就像使用数字一样。</p>
<h4 id="3-3-2-实际应用"><a href="#3-3-2-实际应用" class="headerlink" title="3.3.2 实际应用"></a>3.3.2 实际应用</h4><p>在处理左右边距时使用max()：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@supports(padding: max(0px)) &#123;</div><div class="line">    <span class="selector-class">.post</span> &#123;</div><div class="line">        <span class="attribute">padding-left</span>: <span class="built_in">max</span>(12px, constant(safe-area-inset-left));</div><div class="line">        <span class="attribute">padding-right</span>: <span class="built_in">max</span>(12px, constant(safe-area-inset-right));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>使用 <code>@support()</code> 做功能检测很必要。</p>
</blockquote>
<h3 id="3-4-theme-color"><a href="#3-4-theme-color" class="headerlink" title="3.4 theme color"></a>3.4 theme color</h3><p>iPhone X 在 portrait 模式下（竖屏）状态栏和 URL 地址栏会有一定的透明度，所以他们会显示半透明的网页背景色。</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/theme_color.png" alt="theme_color"></p>
<p>通过声明 <code>theme-color</code> 即可：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"theme-color"</span> <span class="attr">content</span>=<span class="string">"#676767"</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="4-简单的总结"><a href="#4-简单的总结" class="headerlink" title="4 简单的总结"></a>4 简单的总结</h2><p>本文提及的 API：</p>
<ul>
<li><code>viewport-fit</code>：有 <code>contain</code>、<code>cover</code> 和 <code>auto</code> 三个取值。</li>
<li><code>safe-area-inset-*</code>：与 safe area 有关的几个常量，在设置 <code>viewport-fit=cover</code> 后可以使用</li>
<li><code>max()</code> 和 <code>min()</code>：在 CSS 中便利地获取最大值和最小值</li>
</ul>
<h2 id="5-补充扩展"><a href="#5-补充扩展" class="headerlink" title="5 补充扩展"></a>5 补充扩展</h2><p>显然除了使用以上的 API 去适配 iPhone X，还会有其他情况要使用别的适配方式。</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/sharp_outside.gif" alt="sharp_outside"></p>
<p>在张鑫旭大佬的<a href="http://www.zhangxinxu.com/wordpress/2017/09/css-shapes-outside-iphone-x-head/" target="_blank" rel="external">这篇文章</a>中有讲到这种效果如何实现，可以了解一下。</p>
<p>参考资料</p>
<ul>
<li><a href="https://drafts.csswg.org/css-round-display" target="_blank" rel="external">CSS Round Display Level 1</a></li>
<li><a href="https://ayogo.com/blog/ios11-viewport/" target="_blank" rel="external">Understanding the WebView Viewport in iOS 11</a></li>
<li><a href="https://developer.apple.com/documentation/uikit/uiview/positioning_content_relative_to_the_safe_area" target="_blank" rel="external">Positioning Content Relative to the Safe Area</a></li>
<li><a href="http://web.jobbole.com/92448/" target="_blank" rel="external">iPhone X的缺口和CSS</a></li>
<li><a href="http://www.zhangxinxu.com/wordpress/2017/09/css-shapes-outside-iphone-x-head/" target="_blank" rel="external">借助CSS Shapes实现元素滚动自动环绕iPhone X的刘海</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Safari/">Safari</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-decorator-and-its-example" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/12/10/decorator-and-its-example/" class="article-date">
  	<time datetime="2017-12-09T16:00:00.000Z" itemprop="datePublished">2017-12-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/10/decorator-and-its-example/">装饰器及其相关实例</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-装饰器的概念"><a href="#1-装饰器的概念" class="headerlink" title="1. 装饰器的概念"></a>1. 装饰器的概念</h2><h3 id="1-0-前言"><a href="#1-0-前言" class="headerlink" title="1-0. 前言"></a>1-0. 前言</h3><p>装饰器 (Decorator) 是 ES2017 中的一个<a href="https://tc39.github.io/proposal-decorators/" target="_blank" rel="external">提案</a>，装饰器的出现，给我们在多个不同类之间共享或者扩展一些方法或者行为的时候，提供了一种更加优雅的方法。</p>
<h3 id="1-1-什么是装饰器"><a href="#1-1-什么是装饰器" class="headerlink" title="1-1. 什么是装饰器"></a>1-1. 什么是装饰器</h3><p>简单的说，修饰器就是一个对类进行处理的函数，可以给类以及类的方法添加一些行为，而又不改变其代码。<br>在 Python 中，对于 装饰器 (Decorator) 是这样定义的：</p>
<blockquote>
<p>A Python decorator is a function that takes another function, extending the behavior of the latter function without explicitly modifying it.<br>Python 装饰器是接受另一个函数作为参数的函数，扩展参数函数行为的同时并没有修改参数函数本身。</p>
</blockquote>
<p>我们通过一个简单的例子来说明装饰器是什么，以下代码是一个给类添加属性 <code>isTestable</code> 的装饰器，通过 <code>@testable</code> 这样的调用，可以给类增加一个 <code>isTestable = true</code> 的属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">@testable</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestableClass</span> </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testable</span>(<span class="params">target</span>) </span>&#123;</div><div class="line">  target.isTestable = <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">MyTestableClass.isTestable <span class="comment">// true</span></div></pre></td></tr></table></figure>
<h3 id="1-2-设计模式-装饰模式"><a href="#1-2-设计模式-装饰模式" class="headerlink" title="1-2. 设计模式: 装饰模式"></a>1-2. 设计模式: 装饰模式</h3><p>装饰模式是 <em>包装模式 (Wrapper Pattern)</em> 的一种，同为包装模式的还有适配器模式。装饰模式以对客户端透明的方式扩展对象的功能，是继承关系的一个替代方案。</p>
<p>装饰模式的设计模式是为了动态地给一个对象增加额外的行为，单就增加功能来说，装饰模式要比生成子类的方式更加灵活。遇到符合下面描述的情况时，可以考虑使用装饰模式：</p>
<ul>
<li>需要扩展一个类的功能，或者给一个类增加属性</li>
<li>需要动态的给一个对象增加功能，这些功能需要动态的撤销</li>
<li>需要增加一些基本功能的排列组合而产生的非常大量的功能，从而使继承变得不现实</li>
</ul>
<h2 id="2-ES6-中的装饰器"><a href="#2-ES6-中的装饰器" class="headerlink" title="2. ES6 中的装饰器"></a>2. ES6 中的装饰器</h2><p>ES6 中装饰器使用特殊的语法，使用 <code>@</code> 作为标识符，且放置在被装饰代码之前。一个类可以被多个不同的装饰器装饰，在代码进行编译的时候，按照顺序相应执行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@log()</div><div class="line">@immutable()</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</div><div class="line">  @time(<span class="string">'demo'</span>)</div><div class="line">  doSomething() &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此外，装饰器对于类的行为的改变，是在代码编译的时候发生的，并不是在运行时。这意味着，修饰器能在编译阶段运行代码。也就是说，修饰器本质就是编译时执行的函数。</p>
<h3 id="2-1-关于-Object-defineProperty"><a href="#2-1-关于-Object-defineProperty" class="headerlink" title="2-1. 关于 Object.defineProperty"></a>2-1. 关于 <code>Object.defineProperty</code></h3><p>ES6 中的装饰器依赖于 ES5 中的 <code>Object.defineProperty</code>，<code>Object.defineProperty</code> 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性， 并返回这个对象。</p>
<p><code>Object.defineProperty</code> 的语法如下：</p>
<blockquote>
<p>Object.defineProperty(obj, prop, descriptor)</p>
</blockquote>
<p>参数 <code>obj</code> 为要在其上定义属性的对象，<code>prop</code> 为要定义或者修改的属性的名称，<code>descripor</code> 为将被定义或修改的属性描述符，对于属性描述符有哪些，可以看<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="external">这里</a>。<br>该方法返回被传递给函数的对象。</p>
<p><code>Object.defineProperty</code>允许精确添加或修改对象的属性。通过赋值来添加的普通属性会创建在属性枚举期间显示的属性（ <code>for...in</code> 或 <code>Object.keys</code> 方法）， 这些值可以被改变，也可以被删除。这种方法允许这些额外的细节从默认值改变。默认情况下，使用 <code>Object.defineProperty()</code> 添加的属性值是不可变的。</p>
<h3 id="2-2-装饰器的使用"><a href="#2-2-装饰器的使用" class="headerlink" title="2-2. 装饰器的使用"></a>2-2. 装饰器的使用</h3><p>接下来我们通过几个简单的例子来看看，如何使用 ES6 提供的语法糖。</p>
<h4 id="2-2-1-对类的装饰器"><a href="#2-2-1-对类的装饰器" class="headerlink" title="2-2-1. 对类的装饰器"></a>2-2-1. 对类的装饰器</h4><p>像我们在 1-1 中举的例子 <code>testable</code> 就是一个对类进行装饰的例子，这个例子可以用带参数的方法实现，类似于工厂方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testable</span>(<span class="params">isTestable</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target</span>) </span>&#123;</div><div class="line">    target.isTestable = isTestable;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@testable(<span class="literal">true</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestableClass</span> </span>&#123;&#125;</div><div class="line">MyTestableClass.isTestable <span class="comment">// true</span></div><div class="line"></div><div class="line">@testable(<span class="literal">false</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;&#125;</div><div class="line">MyClass.isTestable <span class="comment">// false</span></div></pre></td></tr></table></figure>
<p>前面的例子是为类添加一个静态属性，如果想添加实例属性，可以通过目标类的prototype对象操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testable</span>(<span class="params">target</span>) </span>&#123;</div><div class="line">  target.prototype.isTestable = <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@testable</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestableClass</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> MyTestableClass();</div><div class="line">obj.isTestable <span class="comment">// true</span></div></pre></td></tr></table></figure>
<h4 id="2-2-2-对类属性的装饰器"><a href="#2-2-2-对类属性的装饰器" class="headerlink" title="2-2-2. 对类属性的装饰器"></a>2-2-2. 对类属性的装饰器</h4><p>类属性装饰器适用于类的单独成员，接收三个参数：</p>
<ul>
<li><code>target</code> 被修饰的类</li>
<li><code>name</code> 要修饰的类成员的名字</li>
<li><code>descriptor</code> 要修饰的类成员的描述符</li>
</ul>
<p>可以看到接收参数与 <code>Object.defineProperty</code> 完全类似。</p>
<p>对于类属性的装饰，可以先看一个非常常见的只读实例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">readonly</span>(<span class="params">target, name, descriptor</span>) </span>&#123;</div><div class="line">  discriptor.writable = <span class="literal">false</span>;</div><div class="line">  <span class="keyword">return</span> discriptor;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> </span>&#123;</div><div class="line">  @readonly</div><div class="line">  say() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"meow"</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> wangcai = <span class="keyword">new</span> Cat();</div><div class="line">wangcai.say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"woof"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Exception: Attempted to assign to readonly property</span></div></pre></td></tr></table></figure>
<p>可以看到对 <code>wangcai</code> 的 <code>say</code> 方法进行修改并没有生效，此时 <code>Cat</code> 对象的 <code>say</code> 方法是只读的，不可被赋值表达式改变。</p>
<h4 id="2-2-3-装饰器用于函数"><a href="#2-2-3-装饰器用于函数" class="headerlink" title="2-2-3. 装饰器用于函数"></a>2-2-3. 装饰器用于函数</h4><p>从上文中我们知道，实际上装饰器在代码编译时就运行了，存在函数提升，可以看下面的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> counter = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  counter++;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">@add</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于函数提升的存在，实际执行的代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@add</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> counter;</div><div class="line"><span class="keyword">var</span> add;</div><div class="line"></div><div class="line">counter = <span class="number">0</span>;</div><div class="line"></div><div class="line">add = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  counter++;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>我们想让 <code>counter</code> 输出为 1 ,而<code>counter</code> 在最后给赋值了 0。</p>
<h2 id="3-应用实例"><a href="#3-应用实例" class="headerlink" title="3. 应用实例"></a>3. 应用实例</h2><h3 id="3-1-debounce-去抖动"><a href="#3-1-debounce-去抖动" class="headerlink" title="3-1. debounce (去抖动)"></a>3-1. debounce (去抖动)</h3><p>函数执行次数过于频繁导致性能问题的时候，debounce (去抖动) 可以节约性能提高用户体验。debounce (去抖动)的定义是：</p>
<blockquote>
<p>如果用手指一直按住一个弹簧，它将不会弹起直到你松手为止。</p>
</blockquote>
<p>去抖动通过限制函数执行次数，来提高用户体验。当调用动作 n 毫秒后，才会执行该动作，若在这 n 毫秒内又调用此动作则将重新计算执行时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// core-decorators/src/debounce.js</span></div><div class="line"><span class="keyword">import</span> &#123; decorate, metaFor, internalDeprecation &#125; <span class="keyword">from</span> <span class="string">'./private/utils'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> DEFAULT_TIMEOUT = <span class="number">300</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleDescriptor</span>(<span class="params">target, key, descriptor, [wait = DEFAULT_TIMEOUT, immediate = false]</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> callback = descriptor.value;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="string">'function'</span>) &#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">SyntaxError</span>(<span class="string">'Only functions can be debounced'</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    ...descriptor,</div><div class="line">    value() &#123;</div><div class="line">      <span class="keyword">const</span> &#123; debounceTimeoutIds &#125; = metaFor(<span class="keyword">this</span>); <span class="comment">// 每个 debounce 使用独立的计时器</span></div><div class="line">      <span class="keyword">const</span> timeout = debounceTimeoutIds[key];</div><div class="line">      <span class="keyword">const</span> callNow = immediate &amp;&amp; !timeout;</div><div class="line">      <span class="keyword">const</span> args = <span class="built_in">arguments</span>;</div><div class="line"></div><div class="line">      clearTimeout(timeout);</div><div class="line"></div><div class="line">      debounceTimeoutIds[key] = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        <span class="keyword">delete</span> debounceTimeoutIds[key];</div><div class="line">        <span class="keyword">if</span> (!immediate) &#123;</div><div class="line">          callback.apply(<span class="keyword">this</span>, args);</div><div class="line">        &#125;</div><div class="line">      &#125;, wait);</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (callNow) &#123;</div><div class="line">        callback.apply(<span class="keyword">this</span>, args);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">...args</span>) </span>&#123;</div><div class="line">  internalDeprecation(<span class="string">'@debounce is deprecated and will be removed shortly. Use @debounce from lodash-decorators.\n\n  https://www.npmjs.com/package/lodash-decorators'</span>);</div><div class="line">  <span class="keyword">return</span> decorate(handleDescriptor, args);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-2-混入-Mixin"><a href="#3-2-混入-Mixin" class="headerlink" title="3-2. 混入 (Mixin)"></a>3-2. 混入 (Mixin)</h3><p>混入 (Mixin) 所作的事情即枚举出一个或者多个对象的所有属性，然后将这些属性添加到另一个对象上去。</p>
<p>而实际上 jQuery 中的 <code>jQuery.extend</code>和 lodash 中的 <code>_.mixin</code> 通过不同的调用形式都实现了混入 (Mixin)。</p>
<p>依赖于 <code>Object.assign</code> 我们可以用装饰器的方式实现实现混入 (Mixin)：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mixins</span>(<span class="params">...list</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target</span>) </span>&#123;</div><div class="line">    <span class="built_in">Object</span>.assign(target.prototype, ...list);</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> Foo = &#123;</div><div class="line">  foo() &#123; <span class="built_in">console</span>.log(<span class="string">'foo'</span>) &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">@mixins(Foo)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> MyClass();</div><div class="line">obj.foo() <span class="comment">// "foo"</span></div></pre></td></tr></table></figure>
<h3 id="3-3-简单的日志系统"><a href="#3-3-简单的日志系统" class="headerlink" title="3-3. 简单的日志系统"></a>3-3. 简单的日志系统</h3><p>通过在给类执行前后增加输出的处理，可以实现监控类行为的功能：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> log = <span class="function">(<span class="params">type</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">target, name, descriptor</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> method = descriptor.value;</div><div class="line">    descriptor.value =  <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</div><div class="line">      <span class="built_in">console</span>.info(<span class="string">`(<span class="subst">$&#123;type&#125;</span>) 正在执行: <span class="subst">$&#123;name&#125;</span>(<span class="subst">$&#123;args&#125;</span>) = ?`</span>);</div><div class="line">      <span class="keyword">let</span> ret;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        ret = method.apply(target, args);</div><div class="line">        <span class="built_in">console</span>.info(<span class="string">`(<span class="subst">$&#123;type&#125;</span>) 成功 : <span class="subst">$&#123;name&#125;</span>(<span class="subst">$&#123;args&#125;</span>) =&gt; <span class="subst">$&#123;ret&#125;</span>`</span>);</div><div class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</div><div class="line">        <span class="built_in">console</span>.error(<span class="string">`(<span class="subst">$&#123;type&#125;</span>) 失败: <span class="subst">$&#123;name&#125;</span>(<span class="subst">$&#123;args&#125;</span>) =&gt; <span class="subst">$&#123;error&#125;</span>`</span>);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">IronMan</span> </span>&#123;</div><div class="line">  @log(<span class="string">'IronMan 自检阶段'</span>)</div><div class="line">  check()&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'检查完毕'</span>;</div><div class="line">  &#125;</div><div class="line">  @log(<span class="string">'IronMan 攻击阶段'</span>)</div><div class="line">  attack()&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'击倒敌人'</span>;</div><div class="line">  &#125;</div><div class="line">  @log(<span class="string">'IronMan 机体报错'</span>)</div><div class="line">  error()&#123;</div><div class="line">    <span class="keyword">throw</span> <span class="string">'Something is wrong!'</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> tony = <span class="keyword">new</span> IronMan();</div><div class="line">tony.check();</div><div class="line">tony.attack();</div><div class="line">tony.error();</div><div class="line"></div><div class="line"><span class="comment">// (IronMan 自检阶段) 正在执行: check() = ?</span></div><div class="line"><span class="comment">// (IronMan 自检阶段) 成功 : check() =&gt; 检查完毕</span></div><div class="line"><span class="comment">// (IronMan 攻击阶段) 正在执行: attack() = ?</span></div><div class="line"><span class="comment">// (IronMan 攻击阶段) 成功 : attack() =&gt; 击倒敌人</span></div><div class="line"><span class="comment">// (IronMan 机体报错) 正在执行: error() = ?</span></div><div class="line"><span class="comment">// (IronMan 机体报错) 失败: error() =&gt; Something is wrong!</span></div></pre></td></tr></table></figure>
<h2 id="4-通过-Babel-使用"><a href="#4-通过-Babel-使用" class="headerlink" title="4. 通过 Babel 使用"></a>4. 通过 Babel 使用</h2><p>使用 npm 安装 babel-plugin-transform-decorators-legacy 插件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install babel-plugin-transform-decorators-legacy --save-dev</div></pre></td></tr></table></figure>
<p>配置 <code>.babelrc</code> 文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">"plugins"</span>: [<span class="string">"transform-decorators-legacy"</span>]</div></pre></td></tr></table></figure>
<p>参考资料：</p>
<ul>
<li><a href="https://tc39.github.io/proposal-decorators/" target="_blank" rel="external">Decorators proposal</a></li>
<li><a href="http://es6.ruanyifeng.com/#docs/decorator#类的修饰" target="_blank" rel="external">修饰器 - ECMAScripe 6入门</a></li>
<li><a href="https://www.sitepoint.com/javascript-decorators-what-they-are/" target="_blank" rel="external">JavaScript Decorators: What They Are and When to Use Them</a></li>
<li><a href="http://blog.csdn.net/zhshulin/article/details/38665187" target="_blank" rel="external">设计模式——装饰模式（Decorator）</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="external">Object.defineProperty() - Javaecript | MDN</a></li>
<li><a href="http://taobaofed.org/blog/2015/11/16/es7-decorator/" target="_blank" rel="external">ES7 Decorator 装饰者模式</a></li>
<li><a href="https://jinlong.github.io/2016/04/24/Debouncing-and-Throttling-Explained-Through-Examples/" target="_blank" rel="external">实例解析防抖动（Debouncing）和节流阀（Throttling）</a></li>
<li><a href="https://github.com/lodash/lodash/blob/4.7.0/lodash.js" target="_blank" rel="external">lodash/lodash.js</a></li>
<li><a href="https://github.com/jayphelps/core-decorators/blob/master/src/debounce.js" target="_blank" rel="external">core-decorators/src/debounce.js</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ES6/">ES6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-deep-copy-and-shallow-copy" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/03/01/deep-copy-and-shallow-copy/" class="article-date">
  	<time datetime="2017-02-28T16:00:00.000Z" itemprop="datePublished">2017-03-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/01/deep-copy-and-shallow-copy/">简析 javascript 中的深拷贝和浅拷贝</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-深拷贝和浅拷贝的区别"><a href="#1-深拷贝和浅拷贝的区别" class="headerlink" title="1 深拷贝和浅拷贝的区别"></a>1 深拷贝和浅拷贝的区别</h1><h2 id="1-1-JavaScript-的变量类型"><a href="#1-1-JavaScript-的变量类型" class="headerlink" title="1.1 JavaScript 的变量类型"></a>1.1 JavaScript 的变量类型</h2><p>JavaScript 中的变量类型可以分为两类：</p>
<ul>
<li>基本类型</li>
<li>引用类型</li>
</ul>
<p>基本类型有5种：</p>
<blockquote>
<p>Undefined、Null、Boolean、Number 和 String</p>
</blockquote>
<p>引用类型即我们所说的对象，存放在堆内存。</p>
<blockquote>
<p>实际上引用类型保存的是一个指针，指向引用类型的值。当需要访问引用类型的值时，首先从栈中获得该对象的地址指针，然后再从堆内存中取得所需的数据。</p>
</blockquote>
<h2 id="1-2-JavaScript-的深拷贝和浅拷贝"><a href="#1-2-JavaScript-的深拷贝和浅拷贝" class="headerlink" title="1.2 JavaScript 的深拷贝和浅拷贝"></a>1.2 JavaScript 的深拷贝和浅拷贝</h2><p>深拷贝和浅拷贝都是对于应用类型而言的，简单的说，浅拷贝只复制了引用类型的子级的属性，而浅拷贝不止复制子级的属性，还递归复制了所有层级的属性。</p>
<p>所以可以知道，如果复制的对象中有饮用对象，那么在只复制了引用的情况下，复制产生的新对象和原对象引用的是同一个栈里的值。</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/diff_copy.png" alt="深拷贝浅拷贝图示"></p>
<p>废话不多说，直接上代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> zhang = &#123;</div><div class="line">	name: <span class="string">"san"</span>,</div><div class="line">    age: <span class="number">25</span>,</div><div class="line">    gender: <span class="string">"male"</span></div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> zhang1 = zhang;</div><div class="line"><span class="built_in">console</span>.log(zhang);  <span class="comment">//Object &#123;name: "san", age: 25, gender: "male"&#125;</span></div><div class="line"><span class="built_in">console</span>.log(zhang1); <span class="comment">//Object &#123;name: "san", age: 25, gender: "male"&#125;</span></div><div class="line">zhang1.name = <span class="string">"si"</span>;</div><div class="line"><span class="built_in">console</span>.log(zhang);  <span class="comment">//Object &#123;name: "si", age: 25, gender: "male"&#125;</span></div><div class="line"><span class="built_in">console</span>.log(zhang1); <span class="comment">//Object &#123;name: "si", age: 25, gender: "male"&#125;</span></div></pre></td></tr></table></figure>
<p>明明是修改的 zhang1 的 name ，连 zhang 的 name 也改变了厚，这就是浅拷贝。<br>根据定义我们来实现深拷贝：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> zhang = &#123;</div><div class="line">	name: <span class="string">"san"</span>,</div><div class="line">    age: <span class="number">25</span>,</div><div class="line">    gender: <span class="string">"male"</span></div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> zhang1 = &#123;</div><div class="line">	name: zhang.name,</div><div class="line">    age: zhang.age,</div><div class="line">    gender: zhang.gender</div><div class="line">&#125;;</div><div class="line"><span class="built_in">console</span>.log(zhang);  <span class="comment">//Object &#123;name: "san", age: 25, gender: "male"&#125;</span></div><div class="line"><span class="built_in">console</span>.log(zhang1); <span class="comment">//Object &#123;name: "san", age: 25, gender: "male"&#125;</span></div><div class="line">zhang1.name = <span class="string">"si"</span>;</div><div class="line"><span class="built_in">console</span>.log(zhang);  <span class="comment">//Object &#123;name: "san", age: 25, gender: "male"&#125;</span></div><div class="line"><span class="built_in">console</span>.log(zhang1); <span class="comment">//Object &#123;name: "si", age: 25, gender: "male"&#125;</span></div></pre></td></tr></table></figure>
<h1 id="2-浅拷贝的实现方法"><a href="#2-浅拷贝的实现方法" class="headerlink" title="2 浅拷贝的实现方法"></a>2 浅拷贝的实现方法</h1><h2 id="2-1-引用复制"><a href="#2-1-引用复制" class="headerlink" title="2.1 引用复制"></a>2.1 引用复制</h2><p>浅拷贝只复制第一层的子级属性，所以只要遍历对象的子级属性进行复制就可以了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">shallowClone</span>(<span class="params">copyObj</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> obj = &#123;&#125;;</div><div class="line">  <span class="keyword">for</span> ( <span class="keyword">var</span> i <span class="keyword">in</span> copyObj) &#123;</div><div class="line">    obj[i] = copyObj[i];</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> obj;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> x = &#123;</div><div class="line">  a: <span class="number">1</span>,</div><div class="line">  b: &#123; <span class="attr">f</span>: &#123; <span class="attr">g</span>: <span class="number">1</span> &#125; &#125;,</div><div class="line">  c: [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> ]</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> y = shallowClone(x);</div><div class="line"><span class="built_in">console</span>.log(y.b.f === x.b.f);     <span class="comment">// true</span></div></pre></td></tr></table></figure>
<h2 id="2-2-Object-assign-函数"><a href="#2-2-Object-assign-函数" class="headerlink" title="2.2 Object.assign() 函数"></a>2.2 Object.assign() 函数</h2><p>ES2015中提供了 Object.assign() 函数，用于将指定对象和目标对象合并。 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/assign" target="_blank" rel="external">MDN</a> 上对于该函数的说明是：</p>
<blockquote>
<p>Object.assign() 方法用于将所有可枚举的属性的值从一个或多个源对象复制到目标对象。它将返回目标对象。</p>
</blockquote>
<p>因为 Object.assign() 拷贝的是属性值，加入源对象的属性值是一个指向对象的引用，它也只拷贝那个引用值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> a = &#123; <span class="attr">b</span>: &#123;<span class="attr">c</span>:<span class="number">4</span>&#125; , <span class="attr">d</span>: &#123; <span class="attr">e</span>: &#123;<span class="attr">f</span>:<span class="number">1</span>&#125;&#125; &#125;</div><div class="line"><span class="keyword">let</span> g = <span class="built_in">Object</span>.assign(&#123;&#125;,a)</div><div class="line"><span class="built_in">console</span>.log(g.d) <span class="comment">//Object &#123; e: &#123; f: 1 &#125; &#125;</span></div><div class="line">g.d.e = <span class="number">32</span></div><div class="line"><span class="built_in">console</span>.log(g) <span class="comment">//Object &#123; b: &#123; c: 4 &#125;, d: &#123; e: 32 &#125; &#125;</span></div><div class="line"><span class="built_in">console</span>.log(a) <span class="comment">//Object &#123; b: &#123; c: 4 &#125;, d: &#123; e: 32 &#125; &#125;</span></div><div class="line"><span class="built_in">console</span>.log(h) <span class="comment">//Object &#123; b: &#123; c: 4 &#125;, d: &#123; e: &#123; f: 1 &#125; &#125; &#125;</span></div></pre></td></tr></table></figure>
<h1 id="3-深拷贝的实现方法"><a href="#3-深拷贝的实现方法" class="headerlink" title="3 深拷贝的实现方法"></a>3 深拷贝的实现方法</h1><h2 id="3-1-JSON-parse-和-JSON-stringify"><a href="#3-1-JSON-parse-和-JSON-stringify" class="headerlink" title="3.1 JSON.parse() 和 JSON.stringify()"></a>3.1 JSON.parse() 和 JSON.stringify()</h2><p>通过 <code>JSON.stringify()</code> 获得对象的 json 字符串，然后再通过 <code>JSON.parse()</code>将该字符串转化成实际对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> copya = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(a));</div></pre></td></tr></table></figure>
<p>不过这个方法的缺点也很明显：</p>
<ul>
<li>json 不支持 NaN ，Infinity 和精确的浮点数</li>
<li>不支持 function</li>
</ul>
<p>所以使用这个方法并不好，还考虑到这个方法的效率，虽然简单，但是一般情况下都不会用。</p>
<h2 id="3-2-通过递归解析的拷贝"><a href="#3-2-通过递归解析的拷贝" class="headerlink" title="3.2 通过递归解析的拷贝"></a>3.2 通过递归解析的拷贝</h2><p>这个方法其实就是递归地去解析对象的属性，将解析到的属性一条一条赋值给新的对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepCopy</span>(<span class="params">o, c</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> c = c || &#123;&#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> o) &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> o[i] === <span class="string">'object'</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (o[i].constructor === <span class="built_in">Array</span>) &#123; <span class="comment">//数组</span></div><div class="line">                c[i] = []</div><div class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">//对象</span></div><div class="line">                c[i] = &#123;&#125;</div><div class="line">            &#125;</div><div class="line">            deepCopy(o[i], c[i])</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            c[i] = o[i]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> c</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> a = &#123; <span class="attr">b</span>: &#123;<span class="attr">c</span>:<span class="number">4</span>&#125; , <span class="attr">d</span>: &#123; <span class="attr">e</span>: &#123;<span class="attr">f</span>:<span class="number">1</span>&#125;&#125; &#125;</div><div class="line"><span class="keyword">var</span> g = deepCopy(a, &#123;&#125;);</div><div class="line"><span class="built_in">console</span>.dir(a.b.c); <span class="comment">//4</span></div><div class="line"><span class="built_in">console</span>.dir(g.b.c); <span class="comment">//4</span></div><div class="line">g.b.c = <span class="number">5</span>;</div><div class="line"><span class="built_in">console</span>.dir(a.b.c); <span class="comment">//4</span></div><div class="line"><span class="built_in">console</span>.dir(g.b.c); <span class="comment">//5</span></div></pre></td></tr></table></figure>
<h1 id="3-jQuery-extend-函数的对象拷贝"><a href="#3-jQuery-extend-函数的对象拷贝" class="headerlink" title="3 jQuery.extend() 函数的对象拷贝"></a>3 jQuery.extend() 函数的对象拷贝</h1><h2 id="3-1-jQuery-extend-的基本用法"><a href="#3-1-jQuery-extend-的基本用法" class="headerlink" title="3.1 jQuery.extend() 的基本用法"></a>3.1 jQuery.extend() 的基本用法</h2><p><code>jQuery.extend()</code> 可以实现深拷贝和浅拷贝，这个函数大多情况下用来扩展 jQuery / jQuery.fn 对象的方法，<a href="http://api.jquery.com/jQuery.extend/" target="_blank" rel="external">jQuery官网</a>的解释是：</p>
<blockquote>
<p><strong>Description</strong>: Merge the contents of two or more objects together into the first object.</p>
</blockquote>
<p>个人翻译就是<strong>将多个对象的属性合并到第一个对象中</strong>，如果有同名的属性，则将第一个对象中的属性覆盖,规则上是靠后（右）的对象属性覆盖靠前（左）的对象属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> object1 = &#123;</div><div class="line">  apple: <span class="number">0</span>,</div><div class="line">  banana: &#123; <span class="attr">weight</span>: <span class="number">52</span>, <span class="attr">price</span>: <span class="number">100</span> &#125;,</div><div class="line">  cherry: <span class="number">97</span></div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> object2 = &#123;</div><div class="line">  banana: &#123; <span class="attr">price</span>: <span class="number">200</span> &#125;,</div><div class="line">  durian: <span class="number">100</span></div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> object3 = &#123;</div><div class="line">  banana: &#123; <span class="attr">price</span>: <span class="number">300</span> &#125;,</div><div class="line">  watermalon: <span class="number">50</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// Merge object2 and object3 into object1</span></div><div class="line">$.extend( object1, object2, object3 );</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(object1)); <span class="comment">//&#123;"apple":0,"banana":&#123;"price":300&#125;,"cherry":97,"durian":100,"watermalon":50&#125;</span></div></pre></td></tr></table></figure>
<h2 id="3-2-jQuery-extend-实现浅拷贝和深拷贝"><a href="#3-2-jQuery-extend-实现浅拷贝和深拷贝" class="headerlink" title="3.2 jQuery.extend() 实现浅拷贝和深拷贝"></a>3.2 jQuery.extend() 实现浅拷贝和深拷贝</h2><p>根据 <code>jQuery.extend()</code> 的定义，只需要将要拷贝的对象合并到一个空对象，就可以实现拷贝了。而将 <code>jQuery.extend()</code> 的第一个参数设置成 <code>true</code> ，就可设置成深拷贝。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">b</span>: &#123;<span class="attr">c</span>:<span class="number">4</span>&#125; , <span class="attr">d</span>: &#123; <span class="attr">e</span>: &#123;<span class="attr">f</span>:<span class="number">1</span>&#125;&#125; &#125;</div><div class="line"><span class="keyword">var</span> shallowc = $.extend(&#123;&#125;, a)</div><div class="line"><span class="keyword">var</span> deepc = $.extend(<span class="literal">true</span>, &#123;&#125;, a)</div><div class="line"><span class="built_in">console</span>.dir(obj.b.c); <span class="comment">//4</span></div><div class="line"><span class="built_in">console</span>.dir(shallowc.b.c); <span class="comment">//4</span></div><div class="line"><span class="built_in">console</span>.dir(deepc.b.c); <span class="comment">//4</span></div><div class="line">deepc.b.c = <span class="number">5</span>;</div><div class="line"><span class="built_in">console</span>.dir(obj.b.c); <span class="comment">//4</span></div><div class="line"><span class="built_in">console</span>.dir(shallowc.b.c); <span class="comment">//4</span></div><div class="line"><span class="built_in">console</span>.dir(deepc.b.c); <span class="comment">//5</span></div><div class="line">shallowc.b.c = <span class="number">6</span>;</div><div class="line"><span class="built_in">console</span>.dir(obj.b.c); <span class="comment">//6</span></div><div class="line"><span class="built_in">console</span>.dir(shallowc.b.c); <span class="comment">//6</span></div><div class="line"><span class="built_in">console</span>.dir(deepc.b.c); <span class="comment">//5</span></div></pre></td></tr></table></figure>
<p>可以看到 <code>$.extend({}, a)</code> 和 <code>$.extend(true, {}, a)</code> 得到的对象分别就是浅拷贝和深拷贝得到的对象。<del>文末附上 <code>jQuery.extend()</code> 的源码。</del></p>
<h1 id="4-简单的总结"><a href="#4-简单的总结" class="headerlink" title="4 简单的总结"></a>4 简单的总结</h1><p>说了那么多，需要来简单的概括一下。</p>
<blockquote>
<p><strong>其实深拷贝的需求在实际开发中会出现的频次并不高，对于深拷贝，最好的方法就是抛弃需要深拷贝的代码</strong>。</p>
</blockquote>
<hr>
<p>参考资料：<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/assign" target="_blank" rel="external">Object.assign() - JavaScript|MDN</a><br><a href="http://api.jquery.com/jQuery.extend/" target="_blank" rel="external">jQuery.extend() | jQuery API Documentation</a><br><a href="https://github.com/wengjq/Blog/issues/3" target="_blank" rel="external">javaScript中浅拷贝和深拷贝的实现</a><br><a href="http://larry850806.github.io/2016/09/20/shallow-vs-deep-copy/" target="_blank" rel="external">[Javascript] 關於 JS 中的淺拷貝和深拷貝 · Larry</a></p>
<p>附上 <code>$.extend()</code> 源码<del>（是不是跟楼上的递归很像）</del>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line">jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> options, name, src, copy, copyIsArray, clone,</div><div class="line">		target = <span class="built_in">arguments</span>[ <span class="number">0</span> ] || &#123;&#125;,</div><div class="line">		i = <span class="number">1</span>,</div><div class="line">		length = <span class="built_in">arguments</span>.length,</div><div class="line">		deep = <span class="literal">false</span>;</div><div class="line"></div><div class="line">	<span class="comment">// Handle a deep copy situation</span></div><div class="line">	<span class="keyword">if</span> ( <span class="keyword">typeof</span> target === <span class="string">"boolean"</span> ) &#123;</div><div class="line">		deep = target;</div><div class="line"></div><div class="line">		<span class="comment">// Skip the boolean and the target</span></div><div class="line">		target = <span class="built_in">arguments</span>[ i ] || &#123;&#125;;</div><div class="line">		i++;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Handle case when target is a string or something (possible in deep copy)</span></div><div class="line">	<span class="keyword">if</span> ( <span class="keyword">typeof</span> target !== <span class="string">"object"</span> &amp;&amp; !jQuery.isFunction( target ) ) &#123;</div><div class="line">		target = &#123;&#125;;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Extend jQuery itself if only one argument is passed</span></div><div class="line">	<span class="keyword">if</span> ( i === length ) &#123;</div><div class="line">		target = <span class="keyword">this</span>;</div><div class="line">		i--;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</div><div class="line"></div><div class="line">		<span class="comment">// Only deal with non-null/undefined values</span></div><div class="line">		<span class="keyword">if</span> ( ( options = <span class="built_in">arguments</span>[ i ] ) != <span class="literal">null</span> ) &#123;</div><div class="line"></div><div class="line">			<span class="comment">// Extend the base object</span></div><div class="line">			<span class="keyword">for</span> ( name <span class="keyword">in</span> options ) &#123;</div><div class="line">				src = target[ name ];</div><div class="line">				copy = options[ name ];</div><div class="line"></div><div class="line">				<span class="comment">// Prevent never-ending loop</span></div><div class="line">				<span class="keyword">if</span> ( target === copy ) &#123;</div><div class="line">					<span class="keyword">continue</span>;</div><div class="line">				&#125;</div><div class="line"></div><div class="line">				<span class="comment">// Recurse if we're merging plain objects or arrays</span></div><div class="line">				<span class="keyword">if</span> ( deep &amp;&amp; copy &amp;&amp; ( jQuery.isPlainObject( copy ) ||</div><div class="line">					( copyIsArray = <span class="built_in">Array</span>.isArray( copy ) ) ) ) &#123;</div><div class="line"></div><div class="line">					<span class="keyword">if</span> ( copyIsArray ) &#123;</div><div class="line">						copyIsArray = <span class="literal">false</span>;</div><div class="line">						clone = src &amp;&amp; <span class="built_in">Array</span>.isArray( src ) ? src : [];</div><div class="line"></div><div class="line">					&#125; <span class="keyword">else</span> &#123;</div><div class="line">						clone = src &amp;&amp; jQuery.isPlainObject( src ) ? src : &#123;&#125;;</div><div class="line">					&#125;</div><div class="line"></div><div class="line">					<span class="comment">// Never move original objects, clone them</span></div><div class="line">					target[ name ] = jQuery.extend( deep, clone, copy );</div><div class="line"></div><div class="line">				<span class="comment">// Don't bring in undefined values</span></div><div class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( copy !== <span class="literal">undefined</span> ) &#123;</div><div class="line">					target[ name ] = copy;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Return the modified object</span></div><div class="line">	<span class="keyword">return</span> target;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js对象/">js对象</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/深拷贝/">深拷贝</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-let-and-const-instead-of-var" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/16/let-and-const-instead-of-var/" class="article-date">
  	<time datetime="2017-02-15T16:00:00.000Z" itemprop="datePublished">2017-02-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/16/let-and-const-instead-of-var/">ES6中的let、const和var</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-细数-var-的种种原罪"><a href="#1-细数-var-的种种原罪" class="headerlink" title="1 细数 var 的种种原罪"></a>1 细数 var 的种种原罪</h1><h2 id="1-1-var-使用时的变量提升"><a href="#1-1-var-使用时的变量提升" class="headerlink" title="1.1 var 使用时的变量提升"></a>1.1 var 使用时的变量提升</h2><p>总所周知，JavaScript中的作用域并不是块级作用域，而是函数作用域。所谓的作用域就是可以访问到某一个变量的代码范围，那么函数作用域又是怎么样的呢？<br>简单的来说，在我们用var声明变量时，这个变量的作用域是向声明的上下两个方向同时延伸，直到到达函数边界，这个函数边界包围的代码范围就是var的作用域。<br>也因此js引擎会将每一个var声明和函数声明都提升到封闭的函数顶部，这样才可以在变量的使用前把变量先声明，这种js引擎的处理就是“<strong>变量提升（hoisting）</strong>”。<br>可以看一个简单的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f2</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</div><div class="line">  <span class="built_in">console</span>.log(a);</div><div class="line">  <span class="built_in">console</span>.log(b);</div><div class="line">  <span class="comment">//  console.log(c);</span></div><div class="line">  <span class="keyword">var</span> b = <span class="number">2</span>;</div><div class="line">&#125;</div><div class="line">f2();</div></pre></td></tr></table></figure>
<p>输出结果为：</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/console1.png" alt="console1"></p>
<p>变量提升固然有其必要性，但是有的情况下会出现<code>undefined</code>和<code>ReferenceError</code>，还有相同变量名时产生的错误，都让人感觉困惑难以追查问题。</p>
<h2 id="1-2-闭包的困惑"><a href="#1-2-闭包的困惑" class="headerlink" title="1.2 闭包的困惑"></a>1.2 闭包的困惑</h2><p>MDN上对于<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures" target="_blank" rel="external">闭包（Closure）</a>的定义：</p>
<blockquote>
<p>闭包是指那些能够访问独立(自由)变量的函数 (变量在本地使用，但定义在一个封闭的作用域中)。换句话说，这些函数可以“记忆”它被创建时候的环境</p>
</blockquote>
<p>简单的说，闭包就是指内部函数可以访问外部函数的一种机制，但外部函数并不能访问内部函数的变量。<br>以下是一段前端面试很喜欢用到的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>(), i);</div><div class="line">  &#125;, <span class="number">1000</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="number">1</span>);</div></pre></td></tr></table></figure>
<p>结果应该是立即输出<strong>一个时间点和5</strong>，而在短暂的时间间隔后同时<strong>连续5次输出同一个时间点和5</strong>（考虑到js的定时机制并不是完全准确的，这里的时间间隔应该是大约在1秒后输出）。<br>那为什么不是输出不同的时间和0到5呢？<br>因为这里其实共用了同一个变量<code>i</code>，五个超时回调同时使用一个<code>i</code>，亦即构成了闭包，就会造成在循环完成时，<code>i</code>的值被赋为5，此时所有的超时回调还没有被回调到。<br>那么应该如何去修改成输出不同的结果呢？在这里可以选择一个比较简单的修改，就是用IIFE（Immediately Invoked Function Expression:声明即刻执行的函数表达式）来解决闭包造成的问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params">j</span>) </span>&#123;</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>(), j);</div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">  &#125;)(i);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="number">1</span>);</div></pre></td></tr></table></figure>
<p>可以看出来其实var的这些不便，都是早期的 JavaScript 设计导致的，很多编程语言都是向后兼容的，所以这种设计上的失误无法被修复。所以在 ES6 中推出了新的变量声明关键字<strong>let</strong>，来让作用域规则更加合理。</p>
<h1 id="2-新-var：-let"><a href="#2-新-var：-let" class="headerlink" title="2 新 var： let"></a>2 新 var： let</h1><h2 id="2-1-let-和-var-的区别"><a href="#2-1-let-和-var-的区别" class="headerlink" title="2.1 let 和 var 的区别"></a>2.1 let 和 var 的区别</h2><p>MDN上对于<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/let" target="_blank" rel="external">let</a>语句的定义如下：</p>
<blockquote>
<p>let 语句声明一个块级作用域的本地变量，并且可选的赋予初始值。</p>
</blockquote>
<p>用法和 var 一样，进一步的描述为：</p>
<blockquote>
<p>let允许你声明一个作用域被限制在块级中的变量、语句或者表达式。与var关键字不同的是，var声明的变量只能是全局或者整个函数块的</p>
</blockquote>
<p>简单的说，let 的作用域是块，而 var 的作用域是函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="number">5</span>;</div><div class="line"><span class="keyword">var</span> b = <span class="number">10</span>;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (a === <span class="number">5</span>) &#123;</div><div class="line">  <span class="keyword">let</span> a = <span class="number">4</span>; <span class="comment">// The scope is inside the if-block</span></div><div class="line">  <span class="keyword">var</span> b = <span class="number">1</span>; <span class="comment">// The scope is inside the function</span></div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log(a);  <span class="comment">// 4</span></div><div class="line">  <span class="built_in">console</span>.log(b);  <span class="comment">// 1</span></div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 5</span></div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 1</span></div></pre></td></tr></table></figure>
<p>所以可以知道在程序或者函数的顶层，let 并不会想 var 一样在全局对象上创造一个属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> x = <span class="string">'global'</span>;</div><div class="line"><span class="keyword">let</span> y = <span class="string">'global'</span>;</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.x); <span class="comment">// "global"</span></div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.y); <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<p>此外还要注意一点，<strong>let 变量的重复声明是语法错误</strong>，所以如果有一些脚本声明了相同的全局变量，那么在二次加载的时候会出现报错。</p>
<blockquote>
<p>let 是一个严格模式下的保留词。在非严格模式的代码中，为了向后兼容，你仍然可以声明变量、函数和名为 let 的实参——你可以写 <code>var let = &#39;q&#39;;</code>，而不是你原本想写的那样。<code>let let;</code> 也是不允许的。</p>
</blockquote>
<h2 id="2-2-Const"><a href="#2-2-Const" class="headerlink" title="2.2 Const"></a>2.2 Const</h2><p>const 声明创建一个只读的常量。这不意味着常量指向的值不可变，而是变量标识符的值只能赋值一次。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> PI = <span class="number">3.14</span>;</div><div class="line"></div><div class="line">PI <span class="comment">// 3.14</span></div><div class="line">PI = <span class="number">3</span>; <span class="comment">// TypeError: Assignment to constant variable.</span></div></pre></td></tr></table></figure>
<p>const 的声明需要立即进行赋值，否则会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> FOO; <span class="comment">// SyntaxError: missing = in const declaration</span></div></pre></td></tr></table></figure>
<p>在给一个常量定义成对象时需要注意区分这里的常量指的是这个对象的地址，因为<strong>复合类型的变量，变量名不指向数据，而是指向数据所在的地址</strong>（这里跟C里的指针十分类似）。</p>
<p>可以简单地理解成存储数据的地址是常量，这个地址是不变的，而该存储单元存储的数据是可以改变的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> MY_OBJECT = &#123;<span class="string">"key"</span>: <span class="string">"value"</span>&#125;;</div><div class="line"></div><div class="line">MY_OBJECT = &#123;<span class="string">"OTHER_KEY"</span>: <span class="string">"value"</span>&#125;; <span class="comment">// TypeError: Assignment to constant variable.</span></div><div class="line"></div><div class="line"><span class="comment">// 对象属性并不在保护的范围内，下面这个声明会成功执行</span></div><div class="line">MY_OBJECT.key = <span class="string">"otherValue"</span>;</div></pre></td></tr></table></figure>
<p>还有个关于数组的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> a = [];</div><div class="line">a.push(<span class="string">'Hello'</span>); <span class="comment">// ['Hello']</span></div><div class="line">a.length = <span class="number">0</span>;    <span class="comment">// []</span></div><div class="line">a = [<span class="string">'Dave'</span>];    <span class="comment">// Assignment to constant variable.</span></div></pre></td></tr></table></figure>
<p>参考资料：<br><a href="http://wiki.jikexueyuan.com/project/es-six-deeply/let-and-const.html" target="_blank" rel="external">let 和 const</a><br><a href="https://zhuanlan.zhihu.com/p/25855075" target="_blank" rel="external">80% 应聘者都不及格的 JS 面试题</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/let" target="_blank" rel="external">let - JavaScript|MDN</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ES6/">ES6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作用域/">作用域</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-calendar-diy" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/21/calendar-diy/" class="article-date">
  	<time datetime="2017-01-20T16:00:00.000Z" itemprop="datePublished">2017-01-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/21/calendar-diy/">自制简易日历</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-日历插件的需求分析"><a href="#1-日历插件的需求分析" class="headerlink" title="1. 日历插件的需求分析"></a>1. 日历插件的需求分析</h1><p>在官网电商部分的开发中，遇到了需要自定义日历插件的情况，日历中的每一天都需要显示库存or价格，而此前使用的日历插件仅仅只有选择的功能，在这种情况下简单地研究了下日历的生成以及相关的一些兼容性问题。</p>
<p>所以经过简单的分析，简单总结：</p>
<ul>
<li>正确的日期显示以及排版</li>
<li>响应某一个日期的点击事件</li>
<li>随时对日历的月份进行修改（月份上移or下移），即重新渲染日历</li>
</ul>
<h1 id="2-实际代码编写"><a href="#2-实际代码编写" class="headerlink" title="2. 实际代码编写"></a>2. 实际代码编写</h1><h2 id="2-1-参数约定"><a href="#2-1-参数约定" class="headerlink" title="2.1 参数约定"></a>2.1 参数约定</h2><p>首先我们用一个对象来存储传入的参数，调出一个基本的当月日历，需要传入年、月份。<br>此外根据实际情况需要在每一天显示的内容，增加一个模板的参数，传入每一天所要显示的内容，传入HTML内容即可。<br>除了以上的最基本内容，我这里加入了日历的调整范围，即通过日历的上一月下一月按钮可以到达的最早的月份和最晚的月份。<br>得到的对象如下，这里我们在方法中先声明默认的值，在不传入任何参数的情况下，显示当前月份，并且将对日历月份没有任何限制。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var defaultSeeting = &#123;</div><div class="line">	<span class="string">"year"</span>: new Date().getFullYear(),//年</div><div class="line">    <span class="string">"month"</span>: new Date().getMonth() + 1,//月</div><div class="line">    <span class="string">"template"</span>: <span class="string">"&#123;&#123;date&#125;&#125;"</span>,//日历表格中的模板</div><div class="line">    <span class="string">"refresh"</span>: <span class="literal">false</span>//是否非页面初始化，用以控制事件的绑定</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里面的模板template参数使用以下的规则进行替换：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * @template 表格中一天的模板</div><div class="line"> * 模板替换规则：</div><div class="line"> * &#123;&#123;year&#125;&#125; -&gt; 年</div><div class="line"> * &#123;&#123;month&#125;&#125; -&gt; 月份</div><div class="line"> * &#123;&#123;date&#125;&#125; -&gt; 日期</div><div class="line"> * &#123;&#123;fulldate&#125;&#125; -&gt; 完整的日期</div><div class="line"> * &#123;&#123;day&#125;&#125; -&gt; 周几</div><div class="line"> * </div><div class="line"> */</div></pre></td></tr></table></figure>
<h2 id="2-2-日历的HTML渲染"><a href="#2-2-日历的HTML渲染" class="headerlink" title="2.2 日历的HTML渲染"></a>2.2 日历的HTML渲染</h2><p>我们要渲染的日历是一个<code>table</code>元素，所以本质上要处理的就是在一个<code>7*5</code>、<code>7*4</code>或者<code>7*6</code>的表格中，显示某月的每一个日期，根据表格是否属于该月来控制背景色，从单纯的展示功能来看，只要每一个<code>td</code>中显示的日期和背景颜色正确就可以了。所以我们预计效果图如下：</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/calendar_preview.png" alt="calendar prvew"></p>
<p>先考虑要拼的HTML内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">&lt;table cellpadding=<span class="string">"0"</span>&gt;</div><div class="line">	&lt;tbody&gt;</div><div class="line">    	&lt;tr class=<span class="string">"month"</span>&gt;</div><div class="line">        	&lt;th colspan=<span class="string">"7"</span>&gt;</div><div class="line">            	&lt;div class=<span class="string">"clearfix"</span>&gt;</div><div class="line">                	&lt;div class=<span class="string">"prevMonth"</span>&gt;</div><div class="line">                    	&lt;a class=<span class="string">"prev0"</span> href=<span class="string">"javascript:;"</span> title=<span class="string">"上个月"</span>&gt;上个月&lt;/a&gt;</div><div class="line">                    &lt;/div&gt;</div><div class="line">                    &lt;div class=<span class="string">"dates"</span> data-fullmonth=<span class="string">"2017-2"</span>&gt;</div><div class="line">                    	&lt;em&gt;2017&lt;/em&gt;年&lt;em&gt;2&lt;/em&gt;月</div><div class="line">                    &lt;/div&gt;</div><div class="line">                    &lt;div class=<span class="string">"nextMonth"</span>&gt;</div><div class="line">                    	&lt;a class=<span class="string">"next"</span> href=<span class="string">"javascript:;"</span> title=<span class="string">"下个月"</span>&gt;下个月&lt;/a&gt;</div><div class="line">                    &lt;/div&gt;</div><div class="line">                &lt;/div&gt;</div><div class="line">            &lt;/th&gt;</div><div class="line">        &lt;/tr&gt;</div><div class="line">        &lt;tr class=<span class="string">"week"</span>&gt;</div><div class="line">        	&lt;th class=<span class="string">"weekEnd"</span>&gt;&lt;span&gt;星期日&lt;/span&gt;&lt;/th&gt;</div><div class="line">            &lt;th&gt;&lt;span&gt;星期一&lt;/span&gt;&lt;/th&gt;</div><div class="line">            &lt;th&gt;&lt;span&gt;星期二&lt;/span&gt;&lt;/th&gt;</div><div class="line">            &lt;th&gt;&lt;span&gt;星期三&lt;/span&gt;&lt;/th&gt;</div><div class="line">            &lt;th&gt;&lt;span&gt;星期四&lt;/span&gt;&lt;/th&gt;</div><div class="line">            &lt;th&gt;&lt;span&gt;星期五&lt;/span&gt;&lt;/th&gt;</div><div class="line">            &lt;th class=<span class="string">"weekEnd"</span>&gt;&lt;span&gt;星期六&lt;/span&gt;&lt;/th&gt;</div><div class="line">        &lt;/tr&gt;</div><div class="line">        &lt;tr&gt;</div><div class="line">        	&lt;td&gt;&lt;/td&gt;</div><div class="line">            &lt;td&gt;&lt;/td&gt;</div><div class="line">            &lt;td&gt;&lt;/td&gt;</div><div class="line">            &lt;td&gt;&lt;p&gt;1&lt;/p&gt;&lt;/td&gt;</div><div class="line">            &lt;td&gt;&lt;p&gt;2&lt;/p&gt;&lt;/td&gt;</div><div class="line">            &lt;td&gt;&lt;p&gt;3&lt;/p&gt;&lt;/td&gt;</div><div class="line">            &lt;td&gt;&lt;p&gt;4&lt;/p&gt;&lt;/td&gt;</div><div class="line">        &lt;/tr&gt;</div><div class="line">        //……</div><div class="line">    &lt;/tbody&gt;</div><div class="line">&lt;/table&gt;</div></pre></td></tr></table></figure>
<p>首先我们要获取这个月份有多少天，先以指定月份的次月1号为日期新建一个Date对象，再用这个对象的毫秒数减去一天的毫秒数（86400000）即为该月的最后一天，获取该天的日期就是我们指定的月份有多少天了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var nextMonth1st = new Date(year, month, 1),//指定月份的次月1号</div><div class="line">    maxdays = (new Date(Date.parse(nextMonth1st) - 86400000)).getDate();</div></pre></td></tr></table></figure>
<p>接下来就是日期<code>td</code>的渲染，需要判断对应的<code>td</code>是否为该月中的日期，其实只有以下的条件：</p>
<ul>
<li>小于当前月第一天的</li>
<li>大于当前月最后一天的</li>
</ul>
<p>对于日历来说，其实类似于一个二维的数组结构，所以我们只需要两层遍历去生成日历模板。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (var j = 1; j &lt;= 6; j++) &#123;</div><div class="line">  //...</div><div class="line">  <span class="keyword">for</span> (var k = 1; k &lt;= 7; k++) &#123;</div><div class="line">    //...</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在判断的条件中我们用一个变量来存储当前处于星期几，即</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var i1 = (new Date(y, m - 1 + i)).getDate(), i2 = 1；</div><div class="line"><span class="keyword">for</span> (var j = 1; j &lt;= 6; j++) &#123;</div><div class="line">  //...</div><div class="line">  <span class="keyword">for</span> (var k = 1; k &lt;= 7; k++) &#123;</div><div class="line">    i2 = (j - 1) * 7 + k -i1;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>// 断更待续</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/组件封装/">组件封装</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-intro-about-pushstate" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/31/intro-about-pushstate/" class="article-date">
  	<time datetime="2016-07-30T16:00:00.000Z" itemprop="datePublished">2016-07-31</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/31/intro-about-pushstate/">window.history.pushState引发的血案</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-pushState是什么？"><a href="#1-pushState是什么？" class="headerlink" title="1. pushState是什么？"></a>1. pushState是什么？</h1><p>这两天在实习中，要将官网的后台系统扩展，其中的一个点就是将页面的主体内容用iframe来引用，在被iframe的高度坑过一遍之后，一个问题又浮现在我的脑海中：</p>
<blockquote>
<p>使用iframe时，如果用户点击了浏览器的后退按钮，因为使用的是iframe，那么这时候整个页面都会后退，而不是用户所预料的只是iframe中页面的后退。</p>
</blockquote>
<p>针对于这个问题，首先想到的就是H5的新方法<code>history.pushState()</code>、<code>history.replaceState()</code>和<code>window.onpopstate</code>事件，但是当时由于在忙别的，所以在这个问题没有细想。</p>
<p>简单的说，history对象下的pushState是H5提出的一个新方法，可以将浏览器窗口的URL修改为自己想要的路径，并且将这个路径push到当前页面的页面浏览历史中。</p>
<p>要注意的是，这种URL的修改不会让页面刷新，亦即<strong>不会让页面发生跳转</strong>！</p>
<h5 id="1-1-history-pushState-state-title-url"><a href="#1-1-history-pushState-state-title-url" class="headerlink" title="1.1 history.pushState(state, title, url);"></a>1.1 history.pushState(state, title, url);</h5><p><code>pushState</code>的参数一共有三个:</p>
<ul>
<li><code>state</code>：可以是一个null，也可以是一个完整的对象，用来表示要push的url对应的状态信息。</li>
<li><code>title</code>：字符串，声明要push的url对象的title，实际使用时并没有什么鸟用。</li>
<li><code>url&#39;</code>：要push的history栈里的url，同时也是显示在浏览器地址栏中的地址。要注意该url<strong>不能跨域</strong>。</li>
</ul>
<p>根据该方法传入的state，我们可以通过控制台输出<code>history</code>查看其<code>state</code>，如果该url不是通过<code>pushState</code>或<code>replaceState</code>产生的，那么<code>history.state</code>就是一个null。<del>当然，如果你在pushState时传的state本来就是null，那么当我没说吼</del>。</p>
<p>在Chrome控制台测试该接口，可以看到调用了<code>pushState</code>方法之后，<code>history</code>的<code>length</code>增加了1，即将指定的url添加到了<code>history</code>栈中。</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/pushState.png" alt="pushState@Chrome"></p>
<h5 id="1-2-history-replaceState（state-title-url"><a href="#1-2-history-replaceState（state-title-url" class="headerlink" title="1.2 history.replaceState（state, title, url)"></a>1.2 history.replaceState（state, title, url)</h5><p><code>replaceState</code>的参数与pushState的参数一致。</p>
<p>调用了<code>replaceState</code>方法之后，<code>history</code>的<code>length</code>不变，指定的url没有被添加到<code>history</code>栈中，仅仅只是浏览器地址栏的url改变。</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/replaceState.png" alt="pushState@Chrome"></p>
<h1 id="2-window-onpopstate"><a href="#2-window-onpopstate" class="headerlink" title="2 window.onpopstate"></a>2 window.onpopstate</h1><p><code>window</code>下的<code>popstate</code>事件是在<code>history</code>发生变化时触发，也就是说调用<code>history.go()</code>和<code>history.back()</code>都会触发该事件。<br>但是要注意，我们上面提到的<code>history.pushState()</code>和<code>history.replaceState()</code>并不会触发该事件。</p>
<h1 id="3-仓促结尾的说明"><a href="#3-仓促结尾的说明" class="headerlink" title="3 仓促结尾的说明"></a>3 仓促结尾的说明</h1><p>本来想延伸开来讲一下API的具体应用，但是由于种种原因，在这里就只是简单介绍API的使用方法，具体应用的话等到以后有机会再来介绍（<del>其实就是还没有在生产环节用过…XD</del>）。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTML5/">HTML5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-writing-docs-with-markdown" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/09/writing-docs-with-markdown/" class="article-date">
  	<time datetime="2016-04-08T16:00:00.000Z" itemprop="datePublished">2016-04-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/09/writing-docs-with-markdown/">使用markdown语言写开发文档</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>近来尝试使用markdown来写技术文档，写完之后将写好的markdown文件转成HTML，用该HTML文件作为最终的文档进行管理。这样做的好处是，可以有效的节省时间，就像markdown语言作为一门标记性语言的好处，用户可以更加纯粹的关注文档的内容，而不必花时间在排版工作上。<br>其实包括你现在看到的这篇博客，也是用markdown语言写的，用<code>hexo</code>+<code>github page</code>就可以快速搭建类似该博客的网站了。读者可以在网上搜一下教程，这里不做说明。（我没收宣传费…）</p>
<p>引用一句别人的话，这么纯粹的语言太适合我这么纯粹的人了（严肃脸）</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/serious.jpg" alt="serious"><small>seriously I mean.</small></p>
<blockquote>
<p>Markdown的目标是实现「易读易写」。</p>
</blockquote>
<h1 id="1-Get-start（亦即Markdown基本语法）"><a href="#1-Get-start（亦即Markdown基本语法）" class="headerlink" title="1. Get start（亦即Markdown基本语法）"></a>1. Get start（亦即Markdown基本语法）</h1><p>一开始当然是先要看markdown的基本语法，虽然比较简单：</p>
<h3 id="1-1-标题"><a href="#1-1-标题" class="headerlink" title="1-1. 标题"></a>1-1. 标题</h3><p>标题使用<code>#</code>号，<code>#</code>的数目与标题的大小相关。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="section"># This is an &amp;lt;h1&amp;gt; tag</span></div><div class="line"><span class="section">## This is an &amp;lt;h2&amp;gt; tag</span></div><div class="line"><span class="section">### This is an &amp;lt;h3&amp;gt; tag</span></div><div class="line"><span class="section">#### This is an &amp;lt;h4&amp;gt; tag</span></div><div class="line"><span class="section">##### This is an &amp;lt;h5&amp;gt; tag</span></div><div class="line"><span class="section">###### This is an &amp;lt;h6&amp;gt; tag</span></div></pre></td></tr></table></figure>
<p>效果图如下：</p>
<h1 id="This-is-an-lt-h1-gt-tag"><a href="#This-is-an-lt-h1-gt-tag" class="headerlink" title="This is an &lt;h1&gt; tag"></a>This is an &lt;h1&gt; tag</h1><h2 id="This-is-an-lt-h2-gt-tag"><a href="#This-is-an-lt-h2-gt-tag" class="headerlink" title="This is an &lt;h2&gt; tag"></a>This is an &lt;h2&gt; tag</h2><h3 id="This-is-an-lt-h3-gt-tag"><a href="#This-is-an-lt-h3-gt-tag" class="headerlink" title="This is an &lt;h3&gt; tag"></a>This is an &lt;h3&gt; tag</h3><h4 id="This-is-an-lt-h4-gt-tag"><a href="#This-is-an-lt-h4-gt-tag" class="headerlink" title="This is an &lt;h4&gt; tag"></a>This is an &lt;h4&gt; tag</h4><h5 id="This-is-an-lt-h5-gt-tag"><a href="#This-is-an-lt-h5-gt-tag" class="headerlink" title="This is an &lt;h5&gt; tag"></a>This is an &lt;h5&gt; tag</h5><h6 id="This-is-an-lt-h6-gt-tag"><a href="#This-is-an-lt-h6-gt-tag" class="headerlink" title="This is an &lt;h6&gt; tag"></a>This is an &lt;h6&gt; tag</h6><h3 id="1-2-区块引用"><a href="#1-2-区块引用" class="headerlink" title="1-2. 区块引用"></a>1-2. 区块引用</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="quote">&gt;	This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,</span></div><div class="line"><span class="quote">&gt;	consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.</span></div><div class="line"><span class="quote">&gt;	Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.</span></div><div class="line">&gt;</div><div class="line"><span class="quote">&gt;	Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse</span></div><div class="line"><span class="quote">&gt;	id sem consectetuer libero luctus adipiscing.</span></div></pre></td></tr></table></figure>
<p>效果图如下：</p>
<blockquote>
<p>   This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,<br>   consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.<br>   Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.</p>
<p>   Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse<br>   id sem consectetuer libero luctus adipiscing.</p>
</blockquote>
<h3 id="1-3-列表"><a href="#1-3-列表" class="headerlink" title="1-3. 列表"></a>1-3. 列表</h3><p>对于无序列表，在条目前加星号、加号减号都可以<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">*	</span>The first li element</div><div class="line"><span class="bullet">*	</span>The second li element</div><div class="line"><span class="bullet">*	</span>The third li element</div></pre></td></tr></table></figure></p>
<ul>
<li>The first li element</li>
<li>The second li element</li>
<li>The third li element</li>
</ul>
<p>而对于有序列表，则可以用以下的形式：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">1.	</span>The first li element</div><div class="line"><span class="bullet">2.	</span>The second li element</div><div class="line"><span class="bullet">3.	</span>The third li element</div></pre></td></tr></table></figure></p>
<ol>
<li>The first li element</li>
<li>The second li element</li>
<li>The third li element</li>
</ol>
<h3 id="1-4-代码参考"><a href="#1-4-代码参考" class="headerlink" title="1-4. 代码参考"></a>1-4. 代码参考</h3><h6 id="行内代码"><a href="#行内代码" class="headerlink" title="行内代码"></a>行内代码</h6><p>行内代码可以用反引号包围起来，如：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="code">`inline code`</span></div></pre></td></tr></table></figure></p>
<p>会显示为<code>inline code</code></p>
<h3 id="1-5-代码段"><a href="#1-5-代码段" class="headerlink" title="1-5. 代码段"></a>1-5. 代码段</h3><p>对于一整段的代码，则可以用三个连续的反引号来包围。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">try (code) &#123;</div><div class="line">	//<span class="keyword">do</span> something</div><div class="line">&#125; catch (e) &#123;</div><div class="line">	//<span class="keyword">do</span> something</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="1-6-分割线"><a href="#1-6-分割线" class="headerlink" title="1-6. 分割线"></a>1-6. 分割线</h3><p>一行中用三个以上的星号、减号、底线都可以建立一个分隔线，行内不能有其他内容。<br>也可以在星号或是减号中间插入空格。<br>下面的写法都可以建立分隔线：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">* </span><span class="bullet">* *</span></div><div class="line"><span class="emphasis">***</span></div><div class="line"><span class="strong">*****</span></div><div class="line"><span class="bullet">- </span>- -</div><div class="line">---------------------------------------</div></pre></td></tr></table></figure></p>
<h3 id="1-7-链接"><a href="#1-7-链接" class="headerlink" title="1-7. 链接"></a>1-7. 链接</h3><p>链接的语法也很简单，链接可以插入到行里<a href="http://s1nker.github.io" target="_blank" rel="external">小狒sin的博客</a><br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="string">小狒sin的博客</span>](<span class="link">http://s1nker.github.io</span>)</div></pre></td></tr></table></figure></p>
<h3 id="1-8-图片"><a href="#1-8-图片" class="headerlink" title="1-8. 图片"></a>1-8. 图片</h3><p>其实图片的插入方法和图片有点像：<br><img src="http://7xokdi.com1.z0.glb.clouddn.com/serious.jpg" alt="serious"><small>看来你们不懂生命的可贵~</small><br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">![<span class="string">serious</span>](<span class="link">http://7xokdi.com1.z0.glb.clouddn.com/serious.jpg</span>)</div></pre></td></tr></table></figure></p>
<p>markdown语法的简单介绍就到这里啦~更详尽的资料请戳<a href="http://wowubuntu.com/markdown/" target="_blank" rel="external">这里</a></p>
<h1 id="2-Markdown编辑器推荐"><a href="#2-Markdown编辑器推荐" class="headerlink" title="2. Markdown编辑器推荐"></a>2. Markdown编辑器推荐</h1><p>原则上用任何的文本编辑软件都可以写Markdown，但是专用的编辑器一般是带有预览框的，可以随时看到自己写的Markdown文件编译成HTML后的样子，非常快捷方便。</p>
<h3 id="MarkdownPad2"><a href="#MarkdownPad2" class="headerlink" title="MarkdownPad2"></a>MarkdownPad2</h3><p>网上盛传的windows系统下最好的Markdown编辑器，但是对于我来说似乎不怎么好用……<br>因为不支持GFM等扩展语法，对于程序员来说不能插入代码就失去意义了~</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/markdownpad-screenshoot.png" alt="MarkdownPad2"></p>
<h3 id="SublimeText"><a href="#SublimeText" class="headerlink" title="SublimeText"></a>SublimeText</h3><p>对于钟爱SublimeText的前端程序猿，可以在SublimeText的Package Install中安装markdown编辑的扩展，可以快捷键在预览器上进行HTML预览。这里推荐<code>markdown editing</code>插件。</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/sublime-markdown-extend.png" alt="SublimeText"></p>
<h3 id="Haroopad"><a href="#Haroopad" class="headerlink" title="Haroopad"></a>Haroopad</h3><p>这款工具是在非常偶然的机会下发现的，也是我现在正在使用的。</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/haroopad-screenshoot.png" alt="Haroopad"></p>
<p>个人觉得比较特别的地方是Haroopad支持GFM等markdown语法扩展（点击顶部菜单的‘插入’）：</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/haroopad-insert.png" alt="Haroopad-insert"></p>
<p>可以看到有GFM(Github Flavored Markdown)、MultiMarkdown、PHP Extras Markdown和Haroopad Flavored Markdown，对于程序员来说，有了这些功能就可以更好的书写文档了。</p>
<h3 id="Cmd-Mrakdown"><a href="#Cmd-Mrakdown" class="headerlink" title="Cmd Mrakdown"></a>Cmd Mrakdown</h3><p>这是链接：<a href="https://www.zybuluo.com/mdeditor" target="_blank" rel="external">Cmd Markdown编辑阅读器</a>。</p>
<p>这是一款在线的Markdown编辑器，比较特别的地方在于它可以插入流程图、序列图等图表，对于要在文档中插入图表的情况会更加实用。<br>此外作为一款在线工具有云端保存等功能，也是非常方便。<br>But, 这个工具如果要到处带样式的HTML文件就要买会员咯，有点坑。</p>
<p>此外还推荐一个在线编辑器：<a href="http://www.jianshu.com/" target="_blank" rel="external">简书</a>，更像于内容分享社区，用得比较少，不做过多说明。</p>
<h1 id="3-Markdown语法扩展"><a href="#3-Markdown语法扩展" class="headerlink" title="3. Markdown语法扩展"></a>3. Markdown语法扩展</h1><p>为了满足不同用户群体的需求，产生了不少markdown的语法扩展，比如上面说过了GFM(Github Flavored Markdown)、MultiMarkdown、PHP Extras Markdown等（“不同用户群体”都是程序猿吧？）。<br>在markdown基本语法的基础上增加了一些扩展性的语法，比如像是注释、带语言类型的代码段、<del>删除线</del>等等。</p>
<p>参考资料：<br><a href="http://wowubuntu.com/markdown/" target="_blank" rel="external">Markdown 语法说明 (简体中文版)</a><br><a href="https://guides.github.com/features/mastering-markdown/" target="_blank" rel="external">Mastering Markdown-Gihub Guides</a></p>
<blockquote>
<p>   本文如果有说得不正确的地方，欢迎发送邮件指出~</p>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/development-docs/">development docs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/markdown/">markdown</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-draw-miku-using-css" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/31/draw-miku-using-css/" class="article-date">
  	<time datetime="2016-03-30T16:00:00.000Z" itemprop="datePublished">2016-03-31</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/31/draw-miku-using-css/">用CSS画一个自己的初音</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>某天在写元素的圆角时突然想起，前阵子看了CSS Screct一部分(<a href="https://github.com/cssmagic/CSS-Secrets" target="_blank" rel="external">Github地址</a>)，在线可以试读一部分。试读的章节说到了可以用CSS3的一些新特性画出一些非常奇特的形状，这提醒了我：</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/miku%2Frealize-something.gif" alt="expression"></p>
<p>可以画出更加生动的东西吧！<br>于是尝试一下画一个Q版的初音未来，先上预览图：</p>
<p><img src="http://7xokdi.com1.z0.glb.clouddn.com/miku%2Fmiku-preview.png" alt="miku-preview"></p>
<p>或者可以直接戳<a href="http://htmlpreview.github.io/?https://github.com/s1nker/miku-s1nker.github.io/blob/master/index.html" target="_blank" rel="external">链接</a>。</p>
<p>接下来我简单就图案的几个值得说明的地方来讲解下…</p>
<h1 id="1-弯弯的呆毛"><a href="#1-弯弯的呆毛" class="headerlink" title="1. 弯弯的呆毛"></a>1. 弯弯的呆毛</h1><p><img src="http://7xokdi.com1.z0.glb.clouddn.com/miku%2Ffringe.png" alt="fringe"></p>
<p>其实这个很简单，只用到了border-radius的属性，原理上我们只要设置好div的宽度和高度，再将div的背景色设置为透明，然后根据是要向那个方向弯曲来设置单个方向的border，将border的宽度设置为呆毛的粗度，再控制div单个角的圆角属性就可以了。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">fringe2</span> &#123;</div><div class="line">    <span class="attribute">top</span>: -<span class="number">10em</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">2.3em</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">2em</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">8em</span>;</div><div class="line">    <span class="attribute">border-right</span>: <span class="number">2.5em</span> solid <span class="number">#2acccc</span>;</div><div class="line">    <span class="attribute">border-radius</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5em</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>诶，原来我们看到的那根弯曲的毛其实是div的border呀~</p>
<h1 id="2-上下宽度不同的圆脸"><a href="#2-上下宽度不同的圆脸" class="headerlink" title="2. 上下宽度不同的圆脸"></a>2. 上下宽度不同的圆脸</h1><p><img src="http://7xokdi.com1.z0.glb.clouddn.com/miku%2Fhead.png" alt="head"></p>
<p>这个形状的头看起来有点怪呀…<br>将这个头分解一下，其实可以分成三个部分，上下两个大小不同的半圆和中间的上大下小的梯形。所以这里其实是用伪元素<code>::before</code>和<code>:after</code>来做，把中间的梯形当做div，上下两个半圆就是这个div的<code>::before</code>和<code>:after</code>啦~</p>
<p>这里值得说一下伪元素的妙用，只要用的合适，一个div也可以画出很复杂的图形。还有伪元素是无法应用在窗级元素(如input)上的~之前踩过这个坑~<br>简单看过资料，据W3C的说明因为窗级元素是不能有子元素的，伪元素某种意义上是其附着元素的子元素。但是Chrome里的input支持伪元素的使用…应该是坑…</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#head</span> &#123;</div><div class="line">    <span class="attribute">position</span>: relative;</div><div class="line">    <span class="attribute">width</span>: <span class="number">10em</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">border-top</span>: <span class="number">6em</span> solid <span class="number">#fff1cb</span>;</div><div class="line">    <span class="attribute">border-right</span>: <span class="number">1.5em</span> solid transparent;</div><div class="line">    <span class="attribute">border-bottom</span>: none;</div><div class="line">    <span class="attribute">border-left</span>: <span class="number">1.5em</span> solid transparent;</div><div class="line">    <span class="attribute">z-index</span>: <span class="number">21</span>;</div><div class="line">    <span class="attribute">animation</span>: nodding <span class="number">5s</span> infinite;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#head</span><span class="selector-pseudo">::before</span> &#123;</div><div class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: -<span class="number">11em</span>;</div><div class="line">    <span class="attribute">left</span>: -<span class="number">1.5em</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">13em</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">5em</span>;</div><div class="line">    <span class="attribute">background-color</span>: <span class="number">#fff1cb</span>;</div><div class="line">    <span class="attribute">border-radius</span>: <span class="number">7em</span> <span class="number">7em</span> <span class="number">0</span> <span class="number">0</span> / <span class="number">5em</span> <span class="number">5em</span> <span class="number">0</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#head</span><span class="selector-pseudo">::after</span> &#123;</div><div class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">10em</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">2em</span>;</div><div class="line">    <span class="attribute">background-color</span>: <span class="number">#fff1cb</span>;</div><div class="line">    <span class="attribute">border-radius</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5em</span> <span class="number">5em</span> / <span class="number">0</span> <span class="number">0</span> <span class="number">2em</span> <span class="number">2em</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="3-微笑的小嘴"><a href="#3-微笑的小嘴" class="headerlink" title="3. 微笑的小嘴"></a>3. 微笑的小嘴</h1><p><img src="http://7xokdi.com1.z0.glb.clouddn.com/miku%2Fmouth.png" alt="mouth"></p>
<p>微笑的嘴巴是最容易画的！<img src="http://" alt="smile"><br>这个应该是最简单的，先将div设置成圆形or椭圆形，给背景色设置透明，border-bottom设置为solid，颜色为深灰色，宽度为嘴巴线条的宽度就可以啦~</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#head</span> <span class="selector-class">.mouth</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: -.<span class="number">8em</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">4.1em</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">1.2em</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">1em</span>;</div><div class="line">    <span class="attribute">border-top</span>: .<span class="number">2em</span> solid transparent;</div><div class="line">    <span class="attribute">border-left</span>: .<span class="number">2em</span> solid transparent;</div><div class="line">    <span class="attribute">border-right</span>: .<span class="number">2em</span> solid transparent;</div><div class="line">    <span class="attribute">border-bottom</span>: .<span class="number">2em</span> solid <span class="number">#333</span>;</div><div class="line">    <span class="attribute">border-radius</span>: <span class="number">1em</span>;</div><div class="line">    <span class="attribute">z-index</span>: <span class="number">22</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="4-形状规则的领带"><a href="#4-形状规则的领带" class="headerlink" title="4. 形状规则的领带"></a>4. 形状规则的领带</h1><p><img src="http://7xokdi.com1.z0.glb.clouddn.com/miku%2Ftie.png" alt="tie"></p>
<p>为什么说形状规则呢？且看截图，从上到下其实就是三个我们小学都学过的平面图形优呀！一个是倒立的看起来很胖的梯形，一个是正立的很瘦的梯形，最后一个就是倒立的三角形呀！不要问我为什么最上面的看起来不是梯形…因为被挡了一部分…</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#body</span> <span class="selector-class">.tie</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: .<span class="number">5em</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">1.3em</span>;</div><div class="line">    <span class="attribute">width</span>: .<span class="number">8em</span>;</div><div class="line">    <span class="attribute">border-top</span>: <span class="number">1em</span> solid <span class="number">#2aaaaa</span>;</div><div class="line">    <span class="attribute">border-left</span>: .<span class="number">3em</span> solid transparent;</div><div class="line">    <span class="attribute">border-right</span>: .<span class="number">3em</span> solid transparent;</div><div class="line">    <span class="attribute">z-index</span>: <span class="number">11</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#body</span> <span class="selector-class">.tie</span><span class="selector-pseudo">::before</span> &#123;</div><div class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">left</span>: -.<span class="number">6em</span>;</div><div class="line">    <span class="attribute">width</span>: .<span class="number">8em</span>;</div><div class="line">    <span class="attribute">border-bottom</span>: <span class="number">2.5em</span> solid <span class="number">#2aaaaa</span>;</div><div class="line">    <span class="attribute">border-left</span>: .<span class="number">6em</span> solid transparent;</div><div class="line">    <span class="attribute">border-right</span>: .<span class="number">6em</span> solid transparent;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#body</span> <span class="selector-class">.tie</span><span class="selector-pseudo">::after</span> &#123;</div><div class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: <span class="number">2.5em</span>;</div><div class="line">    <span class="attribute">left</span>: -.<span class="number">6em</span>;</div><div class="line">    <span class="attribute">border-top</span>: .<span class="number">6em</span> solid <span class="number">#2aaaaa</span>;</div><div class="line">    <span class="attribute">border-left</span>: <span class="number">1em</span> solid transparent;</div><div class="line">    <span class="attribute">border-right</span>: <span class="number">1em</span> solid transparent;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="5-形状好像很规则的发夹"><a href="#5-形状好像很规则的发夹" class="headerlink" title="5. 形状好像很规则的发夹"></a>5. 形状好像很规则的发夹</h1><p><img src="http://7xokdi.com1.z0.glb.clouddn.com/miku%2Fhairpin.png" alt="hairpin"></p>
<p>看到这里读者应该很熟悉作者的尿性了…都是伪元素、圆角，能来点高端点的吗？<br>为了提升这篇文章的深度，要强行加入点CSS3的特性才行！<br>一开始也是分解成三个部分，考虑到视角的因素，看得到的只有方形的三个边，所以用一个div加伪元素可以做到。<br>考虑到三种颜色，可以给div设置背景色，用到linear-gradient属性，给背景分成三段，分别设置不同的颜色。<br>倾斜的效果可以用transform的skew属性，将弯折的部分对接起来看起来就是有点立体感的发夹了…</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#head</span> <span class="selector-class">.hair</span> <span class="selector-class">.hairpin</span><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">top</span>: -<span class="number">10em</span>;</div><div class="line">    <span class="attribute">left</span>: -<span class="number">1em</span>;</div><div class="line">    <span class="attribute">transform</span>: <span class="built_in">skew</span>(18deg);</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#head</span> <span class="selector-class">.hair</span> <span class="selector-class">.hairpin</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">width</span>: .<span class="number">6em</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">2.5em</span>;</div><div class="line">    <span class="attribute">background</span>: <span class="number">#333</span>;</div><div class="line">    <span class="attribute">z-index</span>: <span class="number">29</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#head</span> <span class="selector-class">.hair</span> <span class="selector-class">.hairpin</span><span class="selector-class">.left</span><span class="selector-pseudo">::before</span> &#123;</div><div class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: <span class="number">0em</span>;</div><div class="line">    <span class="attribute">left</span>: -<span class="number">1em</span>;</div><div class="line">    <span class="attribute">width</span>: .<span class="number">6em</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">2.5em</span>;</div><div class="line">    <span class="attribute">background</span>: <span class="built_in">-webkit-linear-gradient</span>(90deg, #333 30%, #e04e7d 30%, #e04e7d 70%, #333 0);</div><div class="line">    <span class="attribute">background</span>: <span class="built_in">-o-linear-gradient</span>(90deg, #333 30%, #e04e7d 30%, #e04e7d 70%, #333 0);</div><div class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(90deg, #333 30%, #e04e7d 30%, #e04e7d 70%, #333 0);</div><div class="line">    <span class="attribute">transform</span>: <span class="built_in">skew</span>(-36deg);</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#head</span> <span class="selector-class">.hair</span> <span class="selector-class">.hairpin</span><span class="selector-class">.left</span><span class="selector-pseudo">::after</span> &#123;</div><div class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: <span class="number">2.5em</span>;</div><div class="line">    <span class="attribute">left</span>: -<span class="number">1.7em</span>;</div><div class="line">    <span class="attribute">width</span>: .<span class="number">6em</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">2em</span>;</div><div class="line">    <span class="attribute">background</span>: <span class="built_in">-webkit-linear-gradient</span>(90deg, #333 30%, #e04e7d 30%, #e04e7d 70%, #333 0);</div><div class="line">    <span class="attribute">background</span>: <span class="built_in">-o-linear-gradient</span>(90deg, #333 30%, #e04e7d 30%, #e04e7d 70%, #333 0);</div><div class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(90deg, #333 30%, #e04e7d 30%, #e04e7d 70%, #333 0);</div><div class="line">    <span class="attribute">transform</span>: <span class="built_in">skew</span>(9deg);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="6-简单的总结"><a href="#6-简单的总结" class="headerlink" title="6. 简单的总结"></a>6. 简单的总结</h1><p>总的来说，要画出这样的形象，可以选择的属性有以下这些：</p>
<blockquote>
<ul>
<li>border-top / border-right / border-bottom / border-left</li>
<li>border-radius</li>
<li>::before &amp; ::after</li>
<li>transform: rotate / skew / scale / translate</li>
<li>background: linear-gradient</li>
</ul>
</blockquote>
<p>参考资料：<br><a href="http://www.w3cplus.com/css3/css-secrets/complex-background-pattern.html" target="_blank" rel="external">CSS秘密花园：复杂背景图案</a> 墙裂推荐此书呀！<br><a href="http://one-div.com/" target="_blank" rel="external">one div</a> 有点好玩的一个div实现复杂图形，有很多案例，运用到了很多CSS3特效。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/">css</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 Sinker
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>